<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MEDIARY - AI Destekli Tƒ±bbi Tanƒ± Sistemi</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- <link rel="stylesheet" href="./static/style.css"> -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            overflow-x: hidden;
        }

        /* Header & Navigation */
        .header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            z-index: 1000;
            border-bottom: 1px solid rgba(59, 130, 246, 0.1);
            transition: all 0.3s ease;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem 2rem;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: 700;
            color: #3b82f6;
            text-decoration: none;
            position: relative;
        }

        .logo::after {
            content: '';
            position: absolute;
            bottom: -5px;
            left: 0;
            width: 100%;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #1e40af);
            border-radius: 2px;
        }

        .login-btn {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        /* Hero Section */
        .hero {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 1000"><defs><radialGradient id="a" cx="50%" cy="50%" r="50%"><stop offset="0%" stop-color="rgba(255,255,255,0.1)"/><stop offset="100%" stop-color="rgba(255,255,255,0)"/></radialGradient></defs><circle cx="200" cy="200" r="100" fill="url(%23a)"/><circle cx="800" cy="300" r="150" fill="url(%23a)"/><circle cx="400" cy="700" r="80" fill="url(%23a)"/><circle cx="700" cy="800" r="120" fill="url(%23a)"/></svg>');
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        .hero-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            position: relative;
            z-index: 1;
        }

        .hero-content h1 {
            font-size: 3.5rem;
            font-weight: 700;
            color: white;
            margin-bottom: 1.5rem;
            line-height: 1.2;
        }

        .hero-content .subtitle {
            font-size: 1.25rem;
            color: rgba(255, 255, 255, 0.9);
            margin-bottom: 2rem;
            font-weight: 400;
        }

        .hero-visual {
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .medical-dashboard {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 20px;
            padding: 2rem;
            width: 100%;
            max-width: 500px;
            animation: pulse 3s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .dashboard-title {
            color: white;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .ai-indicator {
            background: linear-gradient(45deg, #10b981, #059669);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .ai-indicator::before {
            content: 'ü§ñ';
            font-size: 1rem;
        }

        .dashboard-content {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .diagnosis-result {
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid rgba(16, 185, 129, 0.3);
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .confidence-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 0.5rem;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            width: 85%;
            animation: fill 2s ease-out;
        }

        @keyframes fill {
            0% { width: 0%; }
            100% { width: 85%; }
        }

        /* LOGIN MODAL */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            position: relative;
            animation: modalSlide 0.3s ease;
        }

        @keyframes modalSlide {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 700;
            color: #1e293b;
            margin-bottom: 2rem;
            text-align: center;
        }

        .login-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-group label {
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-group input, .form-group select {
            padding: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .login-submit {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 1rem 2rem;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .login-submit:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            display: none;
        }

        .credentials-info {
            background: #f0f9ff;
            border: 1px solid #0ea5e9;
            border-radius: 10px;
            padding: 1rem;
            margin-top: 1rem;
            font-size: 0.9rem;
        }

        .credentials-info h4 {
            color: #0c4a6e;
            margin-bottom: 0.5rem;
        }

        .credentials-info p {
            color: #0369a1;
            margin: 0.25rem 0;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* MEDIARY SYSTEM STYLES */
        #mediarySystem {
            display: none;
            min-height: 100vh;
            background: linear-gradient(135deg, #1a2332 0%, #2a3f5f 100%);
            color: white;
            opacity: 0;
            transition: opacity 0.5s ease;
        }

        #mediarySystem.show {
            opacity: 1;
        }

        .system-header {
            background: rgba(255, 255, 255, 0.08);
            padding: 0.5rem 1rem;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(255, 255, 255, 0.15);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .system-header h1 {
            font-size: 2rem;
            font-weight: 700;
            letter-spacing: 2px;
            color: #fff;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
            color: rgba(255, 255, 255, 0.9);
        }

        .back-to-dashboard {
            background: #4CAF50;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            text-decoration: none;
            display: none;
        }

        .back-to-dashboard:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .home-btn {
            background: #ef4444;
            color: white;
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .home-btn:hover {
            background: #dc2626;
            transform: translateY(-2px);
        }

        /* Dashboard View */
        .dashboard-view {
            display: block;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .dashboard-view.hidden {
            display: none;
        }

        .dashboard-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            min-height: calc(100vh - 100px);
        }

        .dashboard-sidebar {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            height: fit-content;
        }

        .welcome-section {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            text-align: center;
        }

        .welcome-section h2 {
            color: #4CAF50;
            margin-bottom: 1rem;
            font-size: 1.5rem;
        }

        .welcome-section p {
            color: rgba(255, 255, 255, 0.9);
            line-height: 1.6;
            margin-bottom: 1rem;
        }

        .user-badge {
            background: linear-gradient(135deg, #4CAF50, #45a049);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .dashboard-content {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .dashboard-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            text-align: center;
            border-left: 4px solid;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-2px);
        }

        .stat-card.patients {
            border-left-color: #4CAF50;
        }

        .stat-card.today {
            border-left-color: #2196F3;
        }

        .stat-card.pending {
            border-left-color: #FF9800;
        }

        .stat-card.completed {
            border-left-color: #9C27B0;
        }

        .stat-number {
            font-size: 2rem;
            font-weight: bold;
            color: white;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
        }

        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }

        .action-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-card:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(255, 255, 255, 0.1);
        }

        .action-card h4 {
            color: white;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .action-card p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.5;
        }

        /* Patient Examination View */
        .examination-view {
            display: none;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
        }

        .examination-view.active {
            display: block;
        }

        .main-container {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
            padding: 2rem;
            max-width: 1600px;
            margin: 0 auto;
            min-height: calc(100vh - 100px);
        }

        .sidebar {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            height: fit-content;
        }

        .sidebar h3 {
            margin-bottom: 1rem;
            color: #f9fafb;
            font-size: 1.1rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .content-area {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 2rem;
        }

        .content-area.examination-content {
            display: grid;
            grid-template-rows: auto 1fr;
            gap: 2rem;
        }

        /* Patient Section Styles */
        .date-picker input[type="date"] {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            width: 100%;
            margin-bottom: 1.5rem;
        }

        .patient-dropdown {
            position: relative;
            margin-bottom: 1.5rem;
        }

        .patient-select {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
            transition: all 0.3s ease;
        }

        .patient-select:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .patient-options {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
            display: none;
            z-index: 100;
            max-height: 200px;
            overflow-y: auto;
        }

        .patient-options.show {
            display: block;
        }

        .patient-option {
            padding: 0.75rem;
            color: #333;
            cursor: pointer;
            transition: background 0.3s ease;
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
        }

        .patient-option:last-child {
            border-bottom: none;
        }

        .patient-option:hover {
            background: rgba(76, 175, 80, 0.1);
        }

        .patient-option.selected {
            background: #4CAF50;
            color: white;
        }

        .patient-info-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #4CAF50;
        }

        .patient-info-display h4 {
            color: #4CAF50;
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .patient-detail {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.25rem;
            font-size: 0.9rem;
        }

        .patient-detail strong {
            color: #f9fafb;
            font-weight: bold;
        }

        .patient-detail span {
            color: #e0f2f1;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 1.2rem;
            background: rgba(255, 255, 255, 0.08);
            padding: 1rem;
            border-radius: 15px;
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.15);
        }

        .nav-tab {
            padding: 1rem 1.8rem;
            border: none;
            background: transparent;
            color: rgba(255, 255, 255, 0.7);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            font-size: 1.1rem;
            position: relative;
        }

        .nav-tab.active {
            background: rgba(255, 255, 255, 0.2);
            color: white;
        }

        .nav-tab:hover:not(.active) {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        .nav-tab.locked {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Content Panel */
        .content-panel {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            padding: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            min-height: 450px;
        }

        /* Tab Contents */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .tab-content:not(.active) {
            display: none !important;
        }

        /* Complaint Section */
        .complaint-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .complaint-area h4 {
            margin-bottom: 1rem;
            color: #f9fafb;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .complaint-text {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem;
            color: white;
            font-size: 0.95rem;
            line-height: 1.6;
            min-height: 200px;
            width: 100%;
            resize: vertical;
            font-family: inherit;
        }

        .complaint-text::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Patient Notes */
        .patient-notes {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #FF9800;
        }

        .patient-notes h4 {
            color: #FF9800;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .note-item {
            margin-bottom: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            font-size: 0.9rem;
            line-height: 1.4;
            color: rgba(255, 255, 255, 0.9);
        }

        .note-item:last-child {
            margin-bottom: 0;
        }

        .note-emphasis {
            font-weight: bold;
            color: #ff6b6b;
            border-left: 3px solid #ff6b6b;
            padding-left: 0.75rem;
        }

        /* Save Button */
        .save-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 1rem;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.9rem;
            width: 100%;
            justify-content: center;
        }

        .save-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(76, 175, 80, 0.3);
        }

        .save-btn.saved {
            background: #2196F3;
        }

        /* Test Request Styles */
        .evaluation-area {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .evaluation-area h4 {
            margin-bottom: 1rem;
            color: #f9fafb;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .ai-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            border-left: 4px solid #2196F3;
        }

        .ai-section h4 {
            color: #2196F3;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
        }

        .test-request-form {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            padding: 1rem;
        }

        .manual-test-entry {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .custom-select-wrapper {
            position: relative;
            width: 100%;
        }

        .suggestion-box {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: #2e2e3f;
            border: 1px solid #555;
            max-height: 200px;
            overflow-y: auto;
            z-index: 100;
            border-radius: 8px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.2);
            display: none;
        }

        .suggestion-box div {
            padding: 0.5rem;
            cursor: pointer;
            color: white;
            border-bottom: 1px solid #444;
        }

        .suggestion-box div:hover {
            background-color: #3a3a4f;
        }


        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        /* AI Analysis Styles */
        .ai-analysis-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            padding: 1.5rem;
        }

        .test-results-section {
            margin-bottom: 2rem;
        }

        .test-results-section h4 {
            color: #f9fafb;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .pdf-files {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .pdf-file {
            background: rgba(220, 38, 38, 0.1);
            border: 2px solid rgba(220, 38, 38, 0.3);
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            color: white;
        }

        .pdf-file:hover {
            background: rgba(220, 38, 38, 0.2);
            transform: translateY(-2px);
        }

        .pdf-file i {
            font-size: 2rem;
            color: #dc2626;
            margin-bottom: 0.5rem;
            display: block;
        }

        .pdf-file span {
            font-size: 0.8rem;
            line-height: 1.2;
        }

        /* Enhanced Evaluate Button */
        .evaluate-btn {
            background: linear-gradient(135deg, #4caf50, #81c784);
            color: white;
            border: none;
            border-radius: 50px;
            font-weight: 600;
            font-size: 1rem;
            padding: 0.75rem 1.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            margin: 1.5rem auto;
            position: relative;
            overflow: hidden;
        }

        .evaluate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s ease;
        }

        .evaluate-btn:hover {
            background: linear-gradient(135deg, #388e3c, #66bb6a);
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(76, 175, 80, 0.4);
        }

        .evaluate-btn:hover::before {
            left: 100%;
        }

        .evaluate-btn:active {
            transform: translateY(0);
            box-shadow: 0 3px 10px rgba(76, 175, 80, 0.3);
        }

        /* Enhanced AI Processing Loader */
        .loading-spinner {
            display: none;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            margin: 2rem 0;
            padding: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .loading-spinner.show {
            display: flex;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255, 255, 255, 0.2);
            border-top: 4px solid #4caf50;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        /* Notification system */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        @keyframes fadeInOut {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Progress Bar for AI Analysis */
        .ai-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 1rem;
        }

        .ai-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #4caf50, #81c784, #4caf50);
            background-size: 200% 100%;
            border-radius: 3px;
            animation: progressMove 2s linear infinite;
            width: 0%;
            transition: width 0.3s ease;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .ai-summary {
            margin-bottom: 2rem;
        }

        /* Re√ßete ve Tanƒ± Ba≈ülƒ±klarƒ± */
        #prescription-tab h4,
        #prescription-tab h5 {
            font-size: 1.3rem;
            font-weight: 600;
            color: #f1f5f9;
            margin-bottom: 1rem;
        }

        /* Etiketler */
        #prescription-tab label {
            font-size: 1rem;
            font-weight: 500;
            color: #e2e8f0;
            margin-bottom: 0.3rem;
            display: block;
        }

        /* Tanƒ± ve ila√ß input alanlarƒ± */
        .diagnosis-input,
        .drug-name,
        .drug-dosage,
        .drug-frequency,
        .drug-duration,
        .prescription-text {
            font-size: 1rem;
            padding: 0.6rem 0.8rem;
            color: #f8fafc;
            background-color: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            width: 100%;
            box-sizing: border-box;
        }

        /* Textarea alanlarƒ± */
        .recommendation-textarea {
            font-size: 1rem;
            padding: 0.8rem;
            color: #f8fafc;
            background-color: #1e293b;
            border: 1px solid #334155;
            border-radius: 8px;
            min-height: 100px;
            resize: vertical;
        }

        /* Placeholder metinleri */
        #prescription-tab input::placeholder,
        #prescription-tab textarea::placeholder {
            font-size: 0.95rem;
            color: #94a3b8;
        }


        .diagnosis-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #9c27b0;
        }

        .diagnosis-section h5 {
            color: #9c27b0;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .diagnosis-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .diagnosis-input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .diagnosis-input-group label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 600;
        }

        .diagnosis-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            font-size: 0.9rem;
        }

        .diagnosis-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .prescription-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #2196f3;
        }

        .prescription-section h5 {
            color: #2196f3;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prescription-list {
            margin-bottom: 1rem;
        }

        .prescription-item {
            margin-bottom: 1rem;
        }

        .drug-info {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr 1fr auto;
            gap: 0.5rem;
            align-items: center;
        }

        .drug-name, .drug-dosage, .drug-frequency, .drug-duration {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 0.5rem;
            color: white;
            font-size: 0.8rem;
        }

        .drug-name::placeholder, .drug-dosage::placeholder, 
        .drug-frequency::placeholder, .drug-duration::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .remove-drug-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .remove-drug-btn:hover {
            background: #dc2626;
        }

        .add-drug-btn {
            background: #10b981;
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.75rem 1rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.3s ease;
        }

        .add-drug-btn:hover {
            background: #059669;
        }

        .recommendations-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #f59e0b;
        }

        .recommendations-section h5 {
            color: #f59e0b;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }

        .recommendation-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .recommendation-item label {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .recommendation-textarea {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 0.75rem;
            color: white;
            font-size: 0.8rem;
            line-height: 1.4;
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .recommendation-textarea::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .additional-notes-section {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-left: 4px solid #6b7280;
        }

        .additional-notes-section h5 {
            color: #6b7280;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .prescription-text {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem;
            color: white;
            font-size: 0.9rem;
            line-height: 1.6;
            min-height: 100px;
            width: 100%;
            resize: vertical;
            font-family: inherit;
        }

        .prescription-text::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .prescription-actions {
            display: flex;
            gap: 1rem;
            margin-top: 2rem;
        }

        /* New Patient Modal Styles */
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-header h2 {
            color: #1e293b;
            font-size: 1.5rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #64748b;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .form-group-full {
            grid-column: 1 / -1;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #333;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
            color: #333;
        }

        .form-input:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 0 3px rgba(76, 175, 80, 0.1);
        }

        .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 0.9rem;
            min-height: 80px;
            resize: vertical;
            font-family: inherit;
        }

        .medical-history-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .medical-history-options {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .radio-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .radio-group input[type="radio"] {
            width: 16px;
            height: 16px;
            accent-color: #4CAF50;
        }

        .radio-group label {
            font-size: 0.9rem;
            color: #374151;
            cursor: pointer;
        }

        .medical-history-detail {
            display: none;
            transition: all 0.3s ease;
        }

        .medical-history-detail.show {
            display: block;
        }

        .modal-actions {
            display: flex;
            gap: 1rem;
            justify-content: flex-end;
            margin-top: 2rem;
        }

        .btn-modal {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn-cancel {
            background: #6b7280;
            color: white;
        }

        .btn-cancel:hover {
            background: #4b5563;
        }

        .btn-confirm {
            background: #10b981;
            color: white;
        }

        .btn-confirm:hover {
            background: #059669;
        }

        /* AI Chatbot Styles */
        .ai-chatbot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 400px;
            height: 500px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(15px);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 2000;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .ai-chatbot.show {
            display: flex;
        }

        .chatbot-header {
            background: linear-gradient(135deg, #3b82f6, #1e40af);
            color: white;
            padding: 1rem;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chatbot-title {
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .chatbot-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: background 0.3s ease;
        }

        .chatbot-close:hover {
            background: rgba(255, 255, 255, 0.2);
        }

        .chatbot-messages {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
            max-height: 350px;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 10px;
            line-height: 1.4;
            font-size: 0.9rem;
        }

        .message.bot {
            background: #f3f4f6;
            color: #374151;
            margin-right: 2rem;
        }

        .message.user {
            background: #3b82f6;
            color: white;
            margin-left: 2rem;
            text-align: right;
        }

        .quick-questions {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .quick-question {
            background: #e5e7eb;
            border: none;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: background 0.3s ease;
            text-align: left;
        }

        .quick-question:hover {
            background: #d1d5db;
        }

        .typing-indicator {
            display: none;
            align-items: center;
            margin: 1rem 0;
            color: #6b7280;
        }

        .typing-indicator.show {
            display: flex;
        }

        .typing-dot {
            width: 8px;
            height: 8px;
            background: #6b7280;
            border-radius: 50%;
            margin-right: 0.25rem;
            animation: typing 1.4s infinite;
        }

        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes progressMove {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .test-checklist {
            margin: 1rem 0;
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .checkbox-item:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .checkbox-item input[type="checkbox"] {
            margin: 0;
            accent-color: #4CAF50;
            transform: scale(1.2);
        }

        .checkbox-item label {
            flex: 1;
            color: #e0f2f1;
            font-size: 0.95rem;
            line-height: 1.6;
            cursor: pointer;
        }

        .priority {
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .priority.urgent {
            background: #f44336;
            color: white;
        }

        .priority.routine {
            background: #2196f3;
            color: white;
        }
        .priority.ai-suggestion {
            background: #3b82f6;
            color: white;
            margin-left: 0.25rem;
        }
        .filter-input {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 0.5rem;
            color: white;
            width: 100%;
            font-size: 0.9rem;
            margin-bottom: 1rem;
        }

        .filter-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .selected-tests-summary {
            background: rgba(76, 175, 80, 0.1);
            border: 1px solid rgba(76, 175, 80, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .selected-tests-summary h5 {
            color: #4CAF50;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .selected-test {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
        }

        .action-buttons {
            display: flex;
            gap: 1rem;
            margin-top: 1rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            text-decoration: none;
            color: white;
            font-size: 0.9rem;
            flex: 1;
            justify-content: center;
        }

        .btn-primary {
            background: #2196F3;
        }

        .btn-primary:hover {
            background: #1976D2;
            transform: translateY(-2px);
        }

        .btn-success {
            background: #4CAF50;
        }

        .btn-success:hover {
            background: #45a049;
            transform: translateY(-2px);
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn-secondary:hover {
            background: #4b5563;
        }

        /* AI Results Animation */


        .summary-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.25rem;
            border-left: 6px solid transparent;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .summary-card::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 60px;
            height: 60px;
            border-radius: 50%;
            opacity: 0.1;
            transition: all 0.3s ease;
        }

        .summary-card.critical {
            border-left-color: #f44336;
            background: rgba(244, 67, 54, 0.08);
            box-shadow: 0 2px 8px rgba(244, 67, 54, 0.2);
        }

        .summary-card.critical::before {
            background: #f44336;
        }

        .summary-card.critical::after {
            content: '‚ö†Ô∏è';
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            animation: pulse 2s infinite;
        }

        .summary-card.recommendation {
            border-left-color: #4caf50;
            background: rgba(76, 175, 80, 0.08);
            box-shadow: 0 2px 8px rgba(76, 175, 80, 0.2);
        }

        .summary-card.recommendation::before {
            background: #4caf50;
        }

        .summary-card.recommendation::after {
            content: '‚úÖ';
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            animation: bounce 2s infinite;
        }

        .summary-card.warning {
            border-left-color: #ff9800;
            background: rgba(255, 152, 0, 0.08);
            box-shadow: 0 2px 8px rgba(255, 152, 0, 0.2);
        }

        .summary-card.warning::before {
            background: #ff9800;
        }

        .summary-card.warning::after {
            content: 'üîç';
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.25rem;
            animation: swing 2s infinite;
        }

        .summary-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 16px rgba(255, 255, 255, 0.1);
        }

        .summary-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.75rem;
        }

        .summary-header strong {
            font-size: 1.1rem;
            font-weight: bold;
            color: #f9fafb;
        }

        .summary-header i {
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .summary-card:hover .summary-header i {
            transform: scale(1.1);
        }

        .summary-card.critical .summary-header i {
            color: #f44336;
        }

        .summary-card.recommendation .summary-header i {
            color: #4caf50;
        }

        .summary-card.warning .summary-header i {
            color: #ff9800;
        }

        .summary-text {
            color: #e0f2f1;
            font-size: 0.95rem;
            line-height: 1.6;
            margin-right: 2rem;
        }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        .chatbot-input-area {
            display: flex;
            padding: 1rem;
            border-top: 1px solid #e5e7eb;
            gap: 0.5rem;
        }

        .chatbot-input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 0.9rem;
        }

        .chatbot-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .chatbot-send {
            background: #3b82f6;
            color: white;
            border: none;
            padding: 0.75rem;
            border-radius: 8px;
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .chatbot-send:hover {
            background: #2563eb;
        }

        /* Notification system */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4caf50;
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            max-width: 350px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        /* Notification Animations */
        @keyframes slideInRight {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideOutRight {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }

        @keyframes fadeInContent {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes fadeOut {
            from { opacity: 1; transform: translateY(0); }
            to { opacity: 0; transform: translateY(-20px); }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .hero-container {
                grid-template-columns: 1fr;
                gap: 2rem;
                text-align: center;
            }

            .hero-content h1 {
                font-size: 2.5rem;
                line-height: 1.1;
            }

            .hero-content .subtitle {
                font-size: 1.1rem;
            }

            .dashboard-grid, .main-container {
                grid-template-columns: 1fr;
                grid-template-rows: auto auto;
                gap: 1rem;
                padding: 1rem;
            }

            .dashboard-sidebar, .sidebar {
                order: 2;
            }
            
            .dashboard-content, .content-area {
                order: 1;
            }

            .modal-content {
                width: 95%;
                margin: 1rem;
                padding: 2rem;
            }

            .modal-title {
                font-size: 1.5rem;
            }

            .main-container {
                grid-template-columns: 1fr;
                gap: 1rem;
                padding: 1rem;
            }

            .nav-tabs {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .nav-tab {
                flex: 1;
                min-width: 140px;
                font-size: 0.8rem;
                padding: 0.6rem 1rem;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .drug-info {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .diagnosis-grid {
                grid-template-columns: 1fr;
            }

            .ai-chatbot {
                width: 95%;
                height: 400px;
                bottom: 10px;
                right: 2.5%;
            }

            /* AI Summary Cards Mobile Optimization */
            .ai-summary-content {
                flex-direction: column;
                gap: 1rem;
            }

            .summary-card {
                margin-bottom: 0.5rem;
                padding: 1rem;
            }

            .summary-text {
                margin-right: 1rem;
                font-size: 0.9rem;
            }

            /* PDF Files Mobile Layout */
            .pdf-files {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .pdf-file {
                padding: 1rem;
            }

            /* Form Grid Mobile */
            .form-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .diagnosis-grid {
                grid-template-columns: 1fr;
            }

            .recommendations-grid {
                grid-template-columns: 1fr;
            }

            .drug-info {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            /* Chatbot Mobile */
            .ai-chatbot {
                width: 100%;
                height: 100%;
                bottom: 0;
                right: 0;
                border-radius: 0;
            }

            .chatbot-header {
                border-radius: 0;
            }

            /* Modal Mobile */
            .modal-content {
                width: 95%;
                margin: 1rem;
                max-height: 90vh;
                overflow-y: auto;
            }

            /* Typography Mobile Adjustments */
            .panel-section h4, .complaint-area h4, .evaluation-area h4, .prescription-tab h4 {
                font-size: 1rem;
            }

            .summary-header strong {
                font-size: 1rem;
            }

        /* Tablet Responsive Design */
        @media (max-width: 1024px) and (min-width: 769px) {
            .main-container {
                grid-template-columns: 250px 1fr;
                gap: 1.5rem;
            }

            .ai-summary-content {
                gap: 0.75rem;
            }

            .pdf-files {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        }
    </style>
</head>
<body>
    <!-- Main Website Content -->
    <div id="main-website">
        <!-- Header -->
        <header class="header">
            <nav class="nav-container">
                <a href="#" class="logo">MEDIARY</a>
                <button class="login-btn" onclick="showLoginModal()">Doktor Giri≈üi</button>
            </nav>
        </header>

        <!-- Hero Section -->
        <section class="hero" id="anasayfa">
            <div class="hero-container">
                <div class="hero-content">
                    <h1>AI ile Tƒ±bbi Tanƒ± Artƒ±k Daha Kolay</h1>
                    <p class="subtitle">Yapay zeka destekli tanƒ± sistemi ile hasta bakƒ±m kalitesini artƒ±rƒ±n. Hƒ±zlƒ±, g√ºvenilir ve hassas tƒ±bbi deƒüerlendirmeler.</p>
                </div>
                <div class="hero-visual">
                    <div class="medical-dashboard">
                        <div class="dashboard-header">
                            <div class="dashboard-title">Tanƒ± Deƒüerlendirmesi</div>
                            <div class="ai-indicator">AI Aktif</div>
                        </div>
                        <div class="dashboard-content">
                            <strong>Hasta:</strong> Mehmet C., 42 ya≈ü<br>
                            <strong>≈ûikayet:</strong> G√∂ƒü√ºs aƒürƒ±sƒ±, nefes darlƒ±ƒüƒ±<br>
                            <strong>S√ºre:</strong> 2 g√ºn
                            <div class="diagnosis-result">
                                <strong>AI Tanƒ± √ñnerisi:</strong><br>
                                Unstabil Angina Pektoris
                                <div class="confidence-bar">
                                    <div class="confidence-fill"></div>
                                </div>
                                <small>G√ºven: %85</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-title">MEDIARY Doktor Giri≈üi ü©∫</h2>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="username">Kullanƒ±cƒ± Adƒ±</label>
                    <input type="text" id="username" required placeholder="Kullanƒ±cƒ± adƒ±nƒ±zƒ± girin">
                </div>
                <div class="form-group">
                    <label for="password">≈ûifre</label>
                    <input type="password" id="password" required placeholder="≈ûifrenizi girin">
                </div>
                <button type="submit" class="login-submit" id="loginSubmit">Sisteme Giri≈ü Yap</button>
                <div class="error-message" id="errorMessage">Kullanƒ±cƒ± adƒ± veya ≈üifre hatalƒ±!</div>
                
                <div class="credentials-info">
                    <h4>ü©∫ Test Giri≈ü Bilgileri:</h4>
                    <p><strong>Dr. S√ºleyman K√∂z:</strong> <span onclick="fillDemoCredentials('skoz', 'doktor123')" style="cursor: pointer; color: #3b82f6; text-decoration: underline;">skoz / doktor123</span></p>
                    <p><strong>Dr. Ay≈üe Demir:</strong> <span onclick="fillDemoCredentials('ademir', 'hekim456')" style="cursor: pointer; color: #3b82f6; text-decoration: underline;">ademir / hekim456</span></p>
                    <p><strong>Dr. Mehmet Yƒ±lmaz:</strong> <span onclick="fillDemoCredentials('myilmaz', 'tip789')" style="cursor: pointer; color: #3b82f6; text-decoration: underline;">myilmaz / tip789</span></p>
                    <p><strong>Admin:</strong> <span onclick="fillDemoCredentials('admin', 'admin123')" style="cursor: pointer; color: #3b82f6; text-decoration: underline;">admin / admin123</span></p>
                </div>
            </form>
        </div>
    </div>

    <!-- MEDIARY SYSTEM -->
    <div id="mediarySystem">
        <header class="system-header">
            <h1>MEDIARY</h1>
            <div class="user-info">
                <i class="fas fa-user-md"></i>
                <span id="currentUserName">Dr. Kullanƒ±cƒ±</span>
                <button class="back-to-dashboard" onclick="showDashboard()" id="backToDashboard">
                    <i class="fas fa-tachometer-alt"></i> Dashboard
                </button>
                <button class="home-btn" onclick="returnToHomepage()">Ana Sayfa</button>
            </div>
        </header>

        <!-- Dashboard View -->
        <div class="dashboard-view" id="dashboardView">
            <div class="dashboard-grid">
                <!-- Sol Panel - Kullanƒ±cƒ± Bilgileri -->
                <div class="dashboard-sidebar">
                    <div class="welcome-section">
                        <h2>ü©∫ Ho≈ü Geldiniz!</h2>
                        <p>MEDIARY AI destekli tƒ±p sistemine ba≈üarƒ±yla giri≈ü yaptƒ±nƒ±z.</p>
                        <div class="user-badge">
                            <i class="fas fa-user-md"></i>
                            <span id="userBadgeName">Dr. Kullanƒ±cƒ±</span>
                        </div>
                    </div>
                    <h3><i class="fas fa-chart-line"></i> G√ºnl√ºk √ñzet</h3>
                    <div class="dashboard-stats">
                        <div class="stat-card patients">
                            <div class="stat-number">4</div>
                            <div class="stat-label">Toplam Hasta</div>
                        </div>
                        <div class="stat-card today">
                            <div class="stat-number">2</div>
                            <div class="stat-label">Bug√ºnk√º Muayene</div>
                        </div>
                    </div>
                </div>
                
                <!-- Ana ƒ∞√ßerik Alanƒ± -->
                <div class="dashboard-content">
                    <h2 style="color: white; margin-bottom: 2rem; display: flex; align-items: center; gap: 0.5rem;">
                        <i class="fas fa-tachometer-alt"></i>
                        Dashboard - Sistem Kontrol Paneli
                    </h2>

                    <div class="dashboard-stats">
                        <div class="stat-card patients">
                            <div class="stat-number">4</div>
                            <div class="stat-label">Kayƒ±tlƒ± Hasta</div>
                        </div>
                        <div class="stat-card today">
                            <div class="stat-number">2</div>
                            <div class="stat-label">Bug√ºnk√º Randevu</div>
                        </div>
                        <div class="stat-card pending">
                            <div class="stat-number">1</div>
                            <div class="stat-label">Bekleyen Tahlil</div>
                        </div>
                        <div class="stat-card completed">
                            <div class="stat-number">3</div>
                            <div class="stat-label">Tamamlanan</div>
                        </div>
                    </div>

                    <div class="quick-actions">
                        <div class="action-card" onclick="startPatientExamination()">
                            <h4><i class="fas fa-user-plus"></i> Hasta Muayenesine Ba≈üla</h4>
                            <p>Yeni hasta kayƒ±t ederek muayene s√ºrecini ba≈ülatƒ±n. AI destekli tanƒ± sistemi ile hƒ±zlƒ± deƒüerlendirme yapƒ±n.</p>
                        </div>
                        
                        <div class="action-card" onclick="viewPatientRecords()">
                            <h4><i class="fas fa-folder-open"></i> Hasta Kayƒ±tlarƒ±nƒ± G√∂r√ºnt√ºle</h4>
                            <p>Mevcut hasta kayƒ±tlarƒ±na eri≈üin, ge√ßmi≈ü muayeneleri inceleyin ve takip s√ºre√ßlerini y√∂netin.</p>
                        </div>
                        
                        <div class="action-card" onclick="openAIAssistant()">
                            <h4><i class="fas fa-robot"></i> AI Asistanƒ±</h4>
                            <p>Tƒ±bbi sorularƒ±nƒ±z i√ßin yapay zeka asistanƒ±ndan yardƒ±m alƒ±n. Genel saƒülƒ±k bilgileri ve √∂neriler.</p>
                        </div>
                        
                        <div class="action-card" onclick="viewReports()">
                            <h4><i class="fas fa-chart-bar"></i> Raporlar ve ƒ∞statistikler</h4>
                            <p>G√ºnl√ºk, haftalƒ±k ve aylƒ±k aktivite raporlarƒ±nƒ±zƒ± g√∂r√ºnt√ºleyin. Performans analizi yapƒ±n.</p>
                        </div>
                    </div>

                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border-radius: 10px; border-left: 4px solid #4CAF50;">
                        <h4 style="color: #4CAF50; margin-bottom: 1rem; display: flex; align-items: center; gap: 0.5rem;">
                            <i class="fas fa-info-circle"></i>
                            Sistem Bilgisi
                        </h4>
                        <p style="color: rgba(255, 255, 255, 0.9); line-height: 1.6;">
                            MEDIARY AI destekli tƒ±p sistemi aktif ve √ßalƒ±≈üƒ±r durumda. T√ºm mod√ºller ba≈üarƒ±yla y√ºklendi. 
                            Hasta muayenesi yapmak i√ßin yukarƒ±daki "Hasta Muayenesine Ba≈üla" se√ßeneƒüini kullanabilirsiniz.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patient Examination View -->
        <div class="examination-view" id="examinationView">
            <div class="main-container">
                <!-- Sol Panel - Hastalar -->
                <div class="sidebar">
                    <h3><i class="fas fa-users"></i> Hastalar <i class="fas fa-calendar-alt"></i></h3>
                
                    <!-- Date Picker -->
                    <div class="date-picker">
                        <input type="date" id="selectedDate" value="">
                    </div> 

                    <!-- Patient Dropdown -->
                    <div class="patient-dropdown">
                        <div class="patient-select" onclick="togglePatientDropdown()">
                            <span id="selectedPatient">Mehmet Kaya</span>
                            <i class="fas fa-chevron-down" id="dropdownArrow"></i>
                        </div>
                        <div class="patient-options" id="patientOptions">
                            <div class="patient-option selected" onclick="selectPatient(this, 1, 'Mehmet Kaya')">
                                Mehmet Kaya
                            </div>
                            <div class="patient-option" onclick="selectPatient(this, 2, 'Fatma Demir')">
                                Fatma Demir
                            </div>
                            <div class="patient-option" onclick="selectPatient(this, 3, 'Zehra √ñzkan')">
                                Zehra √ñzkan
                            </div>
                            <div class="patient-option" onclick="selectPatient(this, 4, 'Ali Veli')">
                                Ali Veli
                            </div>
                        </div>
                    </div>

                    <!-- Patient Info Display -->
                    <div class="patient-info-display" id="patientInfoDisplay">
                        <h4>Hasta Bilgileri</h4>
                        <div class="patient-detail">
                            <strong>TC:</strong>
                            <span id="patientTC">12345678901</span>
                        </div>
                        <div class="patient-detail">
                            <strong>Ya≈ü:</strong>
                            <span id="patientAge">42</span>
                        </div>
                        <div class="patient-detail">
                            <strong>Cinsiyet:</strong>
                            <span id="patientGender">Erkek</span>
                        </div>
                        <div class="patient-detail">
                            <strong>Kan Grubu:</strong>
                            <span id="patientBloodType">A+</span>
                        </div>
                    </div>
                    
                    <button class="save-btn" onclick="showAddPatientModal()">
                        <i class="fas fa-user-plus"></i>
                        Yeni Hasta Kayƒ±t
                    </button>
                    
                    <button class="save-btn" onclick="showAIAssistant()" style="background: #FF9800; margin-top: 0.5rem;">
                        <i class="fas fa-robot"></i>
                        Yapay Zeka Asistanƒ±
                    </button>

                </div>

                <!-- Ana ƒ∞√ßerik Alanƒ± - Muayene -->
                <div class="content-area">
                    <div class="nav-tabs">
                        <button class="nav-tab active" onclick="showTab('preview')">
                            <i class="fas fa-eye"></i>
                            Hasta √ñn G√∂r√º≈üme
                        </button>
                        <button class="nav-tab locked" id="evaluationTab" onclick="showTab('evaluation')">
                            <i class="fas fa-clipboard-check"></i>
                            Tahlil ƒ∞steƒüi
                            <i class="fas fa-lock" style="font-size: 0.7rem; margin-left: 0.3rem;"></i>
                        </button>
                        <button class="nav-tab locked" id="aiAnalysisTab" onclick="showTab('ai-analysis')">
                            <i class="fas fa-brain"></i>
                            AI Yorumu
                            <i class="fas fa-lock" style="font-size: 0.7rem; margin-left: 0.3rem;"></i>
                        </button>
                        <button class="nav-tab locked" id="prescriptionTab" onclick="showTab('prescription')">
                            <i class="fas fa-prescription-bottle-alt"></i>
                            Re√ßete ve Sonu√ß
                            <i class="fas fa-lock" style="font-size: 0.7rem; margin-left: 0.3rem;"></i>
                        </button>
                    </div>

                    <div class="content-panel">
                        <!-- Hasta ≈ûikayeti -->
                        <div id="preview-tab" class="tab-content active">
                            <div class="complaint-area">
                                <h4><i class="fas fa-comment-medical"></i> Hasta ≈ûikayeti</h4>
                                
                                <!-- Hasta Notlarƒ± -->
                                <div class="patient-notes">
                                    <h4>
                                        <i class="fas fa-sticky-note"></i>
                                        Hasta Notlarƒ±
                                    </h4>
                                    <div class="note-item note-emphasis">
                                        Penisilin ilacƒ±na kar≈üƒ± alerjisi bulunmaktadƒ±r.
                                    </div>
                                    <div class="note-item">
                                        Aktif olarak 'Lisinopril' ilacƒ±nƒ± g√ºnde 1 kez kullanmaktadƒ±r.
                                    </div>
                                    <div class="note-item">
                                        Ge√ßmi≈üte b√∂brek ta≈üƒ± √∂yk√ºs√º mevcut. Aile √∂yk√ºs√ºnde b√∂brek yetmezliƒüi var.
                                    </div>
                                </div>
                                
                                <textarea class="complaint-text" id="complaintText" placeholder="Hastanƒ±n ≈üikayetini yazƒ±nƒ±z...">Yakla≈üƒ±k √º√ß g√ºnd√ºr saƒü b√∂brek b√∂lgemde ara ara ≈üiddetlenen keskin bir aƒürƒ± hissediyorum. Aƒürƒ± √∂zellikle hareket ettiƒüimde artƒ±yor ve bazen dayanƒ±lmaz hale geliyor. ƒ∞drar yaparken yanma hissi ya≈üƒ±yorum ve idrar rengimde koyula≈üma fark ettim. Ayrƒ±ca zaman zaman idrarda kan g√∂rd√ºm. Son iki g√ºnd√ºr mide bulantƒ±sƒ± olan ve kendimi yorgun hissediyorum. Daha √∂nce b√∂brek ta≈üƒ± d√º≈ü√ºrm√º≈üt√ºm ve ailemde b√∂brek yetmezliƒüi √∂yk√ºs√º var. G√ºnl√ºk su t√ºketimim olduk√ßa az ve son zamanlarda tuzlu gƒ±dalar t√ºketmeye ba≈üladƒ±m. Aƒürƒ±mƒ± hafifletmek i√ßin sƒ±cak su torbasƒ± kullanƒ±yorum, bu bir nebze rahatlama saƒülƒ±yor. Tansiyon ila√ßlarƒ± kullanƒ±yorum ve ge√ßmi≈üte antibiyotik alerjisi ya≈üamƒ±≈ütƒ±m.</textarea>

                                <button class="save-btn" id="saveComplaintBtn" onclick="saveComplaintAndUnlock()">
                                    <i class="fas fa-save"></i>
                                    Tahlil ƒ∞steƒüinde Bulun
                                </button>

                                <!-- <div class="result-section">
                                    <h4><i class="fas fa-vial"></i> √ñnerilen Tahliller</h4>
                                    <div id="resultArea" class="note-item note-emphasis">
                                    </div>
                                </div> -->
                            </div>
                        </div>

                        <!-- Tahlil ƒ∞steƒüi -->
                        <div id="evaluation-tab" class="tab-content">
                            
                            <div class="evaluation-area">
                                <h4><i class="fas fa-stethoscope"></i> Tahlil ƒ∞steƒüi</h4>
                            
                                <!-- Tetkik ƒ∞stek Formu -->
                                <div class="ai-section">
                                    <h4><i class="fas fa-clipboard-list"></i> Tetkik ƒ∞stek Bildirimi</h4>
                                    <div class="test-request-form">
                                        <input type="text" class="filter-input" placeholder="Tetkik ara..." id="testSearchInput">
                                    
                                        <div class="loading-spinner" id="testLoadingSpinner">
                                            <div class="spinner"></div>
                                            <span>Tetkikler y√ºkleniyor...</span>
                                            <div class="ai-progress-bar">
                                                <div class="ai-progress-fill" id="testProgressFill"></div>
                                            </div>
                                        </div>

                                        <div class="test-checklist" id="testChecklist">
                                        </div>

                                        <!-- Manuel Test Ekleme Alanƒ± -->
                                        <div class="custom-select-wrapper">
                                            <input type="text" id="manualTestInput" placeholder="Yeni tetkik giriniz..." class="filter-input" oninput="filterSuggestions()">
                                            <div id="customSuggestions" class="suggestion-box"></div>
                                            <button onclick="addManualTest()" class="btn btn-secondary">+ Ekle</button>
                                        </div>
                            
                                        <!-- Se√ßilen Testler √ñzeti -->
                                        <div class="selected-tests-summary">
                                            <div style="margin-top: 1rem;">
                                                <h5 id="selectedTestCount">Se√ßilen Tetkikler (0 adet):</h5>
                                                <div id="selectedTestsList">
                                                    <div class="selected-test">‚Ä¢ ƒ∞drar Tahlili (√úrinanaliz)</div>
                                                    <div class="selected-test">‚Ä¢ Serum Kreatinin & GFR</div>
                                                    <div class="selected-test">‚Ä¢ B√∂brek & Mesane Ultrasonu</div>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- G√∂nder Butonu -->
                                        <div class="action-buttons" style="margin-top: 1.5rem;">
                                            <button class="btn btn-primary" onclick="requestTestsAndUnlock()">
                                                <i class="fas fa-paper-plane"></i> 
                                                Tetkik ƒ∞steƒüi G√∂nder
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>  
                        </div>

                        <!-- AI Yorumu -->
                        <div id="ai-analysis-tab" class="tab-content">
                            <div class="ai-analysis-container">
                                <!-- Test Sonu√ßlarƒ± Y√ºkleme B√∂l√ºm√º -->
                                <div class="test-results-section">
                                    <h4><i class="fas fa-file-upload"></i> Tahlil Sonu√ßlarƒ± Sisteme Y√ºklendi</h4>
                                    
                                    <div class="pdf-files">
                                        <div class="pdf-file" onclick="viewPDF('kan-tahlili')">
                                            <i class="fas fa-file-pdf"></i>
                                            <span style="font-size: 1.1rem;">Kan Tahlili<br>Sonu√ßlarƒ±</span>
                                        </div>
                                        <div class="pdf-file" onclick="viewPDF('idrar-tahlili')">
                                            <i class="fas fa-file-pdf"></i>
                                            <span style="font-size: 1.1rem;">ƒ∞drar Tahlili<br>Sonu√ßlarƒ±</span>
                                        </div>
                                        <div class="pdf-file" onclick="viewPDF('ultrason')">
                                            <i class="fas fa-file-pdf"></i>
                                            <span style="font-size: 1.1rem;">Ultrason<br>Raporu</span>
                                        </div>
                                    </div>
                                    
                                    <button class="evaluate-btn" onclick="evaluateTests()" id="evaluateBtn">
                                        <i class="fas fa-brain"></i>
                                        Testleri AI ile Deƒüerlendir
                                    </button>
                                    
                                    <div class="loading-spinner" id="evaluationLoading">
                                        <div class="spinner"></div>
                                        <span>AI verilerinizi deƒüerlendiriyor...</span>
                                        <div class="ai-progress-bar">
                                            <div class="ai-progress-fill" id="progressFill"></div>
                                        </div>
                                    </div>
                                </div>

                                <!-- AI Sonu√ßlarƒ± -->
                                <div class="ai-results" id="aiResults" style="display: none;">
                                    <!-- AI Genel Yorumu -->
                                    <div class="ai-section ai-summary">
                                        <h4 style="color: #ffffff; font-size: 1.1rem;">
                                            <i class="fas fa-brain"></i> AI Genel Deƒüerlendirme</h4>

                                        <div class="ai-summary-content" style="display: flex; flex-direction: column; gap: 1.5rem;">
                                            <div class="summary-card critical" style="padding: 1rem; background-color: #7792a5; border-radius: 8px;">
                                                <div class="summary-header">
                                                    <i class="fas fa-exclamation-triangle"></i>
                                                    <strong> Kritik Bulgular</strong>
                                                </div>
                                                <div class="summary-text">
                                                    <h4>Y√ºkleniyor...</h4>
                                                </div>
                                            </div>

                                            <div class="summary-card recommendation" style="padding: 1rem; background-color: #7792a5;border-radius: 8px;">
                                                <div class="summary-header" style="margin-bottom: 0.5rem;">
                                                    <i class="fas fa-lightbulb"></i>
                                                    <strong> Tedavi √ñnerileri</strong>
                                                </div>
                                                <div class="summary-text">
                                                    <h4>Y√ºkleniyor...</h4>
                                                </div>
                                            </div>

                                            <div class="summary-card warning" style="padding: 1rem; background-color: #7792a5;border-radius: 8px;">
                                                <div class="summary-header" style="margin-bottom: 0.5rem;">
                                                    <i class="fas fa-shield-alt"></i>
                                                    <strong> Dikkat Edilmesi Gerekenler</strong>
                                                </div>
                                                <div class="summary-text">
                                                    <h4>Y√ºkleniyor...</h4>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Dƒ±≈ü Model Entegrasyonu -->
                                    <div class="external-model-section" style="background-color: #1a1a49; padding: 1.5rem; border-radius: 10px; color: #f0f0f0;">
                                        <h4 style="color: #a9d6ff; margin-bottom: 1rem;">
                                            <i class="fas fa-network-wired"></i> Harici AI Model Entegrasyonu
                                        </h4>

                                        <div class="model-status" style="color: #8fff8f; margin-bottom: 1rem;">
                                            <i class="fas fa-check-circle"></i>
                                            <span>MedicalAI v2.1 Modeli ile baƒülantƒ± ba≈üarƒ±lƒ±</span>
                                        </div>

                                        <div class="model-response">
                                            <h5 style="color: #ff9bee; margin-bottom: 1rem;">üî¨ Harici Model Analizi:</h5>
                                            <p style="color: #e0e0ff; line-height: 1.7; font-size: 1rem;">
                                                <strong>Tanƒ± G√ºvenilirliƒüi:</strong> %87<br>
                                                <strong>Risk Skorlamasƒ±:</strong> Orta Risk<br>
                                                <strong>√ñnerilen Protokol:</strong> Konservatif tedavi<br>
                                                <strong>Takip S√ºresi:</strong> 2-4 hafta<br><br>
                                                <em style="color: #cccccc;">
                                                    Bu analiz 50,000+ benzer vaka √ºzerinde eƒüitilmi≈ü AI model tarafƒ±ndan olu≈üturulmu≈ütur. 
                                                    Klinik karar i√ßin doktor onayƒ± gereklidir.
                                                </em>
                                            </p>
                                        </div>
                                    </div>

                                    <button class="evaluate-btn" onclick="unlockPrescriptionTab()" style="background: linear-gradient(135deg, #22c55e, #16a34a);">
                                        <i class="fas fa-prescription"></i>
                                        Re√ßete Hazƒ±rlamaya Ge√ß
                                    </button>
                                </div>
                            </div>
                        </div>

                        <!-- Re√ßete -->
                        <div id="prescription-tab" class="tab-content">
                            <h4><i class="fas fa-prescription"></i> Re√ßete ve Sonu√ß</h4>

                                <!-- Tanƒ± B√∂l√ºm√º -->
                                <div class="diagnosis-section">
                                    <h5><i class="fas fa-diagnoses"></i> Kesin Tanƒ±</h5>
                                    <div class="diagnosis-grid">
                                        <div class="diagnosis-input-group">
                                            <label>Ana Tanƒ± (ICD-10)</label>
                                            <input type="text" class="diagnosis-input" id="primaryDiagnosis" placeholder="√ñrn: N20.0 - B√∂brek Ta≈üƒ±">
                                        </div>
                                        <div class="diagnosis-input-group">
                                            <label>Ek Tanƒ±lar</label>
                                            <input type="text" class="diagnosis-input" id="secondaryDiagnosis" placeholder="Varsa ek tanƒ±larƒ± yazƒ±nƒ±z">
                                        </div>
                                    </div>
                                </div>

                                <!-- ƒ∞la√ß Re√ßetesi -->
                                <div class="prescription-section">
                                    <h5><i class="fas fa-pills"></i> ƒ∞la√ß Re√ßetesi</h5>
                                    <div class="prescription-list" id="prescriptionList">
                                        <div class="prescription-item">
                                            <div class="drug-info">
                                                <input type="text" class="drug-name" placeholder="ƒ∞la√ß adƒ±" />
                                                <input type="text" class="drug-dosage" placeholder="Dozaj" />
                                                <input type="text" class="drug-frequency" placeholder="Kullanƒ±m sƒ±klƒ±ƒüƒ±" />
                                                <input type="text" class="drug-duration" placeholder="S√ºre" />
                                                <button class="remove-drug-btn" onclick="removeDrug(this)">
                                                    <i class="fas fa-times"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <button class="add-drug-btn" onclick="addDrug()">
                                        <i class="fas fa-plus"></i>
                                        ƒ∞la√ß Ekle
                                    </button>
                                </div>

                                <!-- √ñneriler ve Talimatlar -->
                                <div class="recommendations-section">
                                    <h5><i class="fas fa-lightbulb"></i> Hasta √ñnerileri ve Talimatlar</h5>
                                    <div class="recommendations-grid">
                                        <div class="recommendation-item">
                                            <label><i class="fas fa-utensils"></i> Diyet √ñnerileri</label>
                                            <textarea class="recommendation-textarea" id="dietRecommendations" placeholder="Beslenme ve diyet √∂nerilerinizi yazƒ±nƒ±z..."></textarea>
                                        </div>
                                        <div class="recommendation-item">
                                            <label><i class="fas fa-running"></i> Aktivite/Egzersiz</label>
                                            <textarea class="recommendation-textarea" id="activityRecommendations" placeholder="Fiziksel aktivite ve egzersiz √∂nerilerinizi yazƒ±nƒ±z..."></textarea>
                                        </div>
                                        <div class="recommendation-item">
                                            <label><i class="fas fa-exclamation-triangle"></i> Dikkat Edilmesi Gerekenler</label>
                                            <textarea class="recommendation-textarea" id="warningRecommendations" placeholder="Hastanƒ±n dikkat etmesi gereken durumlarƒ± yazƒ±nƒ±z..."></textarea>
                                        </div>
                                        <div class="recommendation-item">
                                            <label><i class="fas fa-calendar-check"></i> Kontrol ve Takip</label>
                                            <textarea class="recommendation-textarea" id="followupRecommendations" placeholder="Kontrol randevu ve takip √∂nerilerinizi yazƒ±nƒ±z..."></textarea>
                                        </div>
                                    </div>
                                </div>

                                <!-- Ek Notlar -->
                                <div class="additional-notes-section">
                                    <h5><i class="fas fa-sticky-note"></i> Ek Notlar</h5>
                                    <textarea class="prescription-text" id="prescriptionText" placeholder="Ek notlar, √∂zel durumlar ve diƒüer √∂nerilerinizi buraya yazƒ±nƒ±z..."></textarea>
                                </div>

                                <div class="prescription-actions">
                                    <button class="save-btn" id="savePrescriptionBtn" onclick="savePrescription()">
                                        <i class="fas fa-save"></i>
                                        Re√ßeteyi Kaydet
                                    </button>
                                    <button class="save-btn" onclick="printPrescription()" style="background: #2196F3; margin-left: 1rem;">
                                        <i class="fas fa-print"></i>
                                        Re√ßeteyi Yazdƒ±r
                                    </button>
                                </div>
                        </div> 
                    </div>
                </div> 
    

        <!-- New Patient Modal -->
        <div class="modal" id="newPatientModal">
            <div class="modal-content">
                <div class="modal-header">
                    <h2><i class="fas fa-user-plus"></i> Yeni Hasta Kaydƒ±</h2>
                    <button class="close-btn" onclick="closeAddPatientModal()">&times;</button>
                </div>
                
                <form id="newPatientForm">
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="newPatientName">Hasta Adƒ±/Soyadƒ± *</label>
                            <input type="text" class="form-input" id="newPatientName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newPatientAge">Ya≈ü *</label>
                            <input type="number" class="form-input" id="newPatientAge" min="0" max="120" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newPatientTC">T.C. Kimlik Numarasƒ± *</label>
                            <input type="text" class="form-input" id="newPatientTC" maxlength="11" pattern="\d{11}" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newPatientBloodType">Kan Grubu *</label>
                            <select class="form-input" id="newPatientBloodType" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <option value="A+">A Rh+</option>
                                <option value="A-">A Rh‚àí</option>
                                <option value="B+">B Rh+</option>
                                <option value="B-">B Rh‚àí</option>
                                <option value="AB+">AB Rh+</option>
                                <option value="AB-">AB Rh‚àí</option>
                                <option value="O+">0 Rh+</option>
                                <option value="O-">0 Rh‚àí</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="newPatientGender">Cinsiyet *</label>
                            <select class="form-input" id="newPatientGender" required>
                                <option value="" disabled selected>Se√ßiniz</option>
                                <option value="Erkek">Erkek</option>
                                <option value="Kadƒ±n">Kadƒ±n</option>
                            </select>
                        </div>
                    </div>
                    
                    <!-- Ge√ßmi≈ü Tƒ±bbi √ñyk√º -->
                    <div class="form-group form-group-full">
                        <label class="form-label">Ge√ßmi≈ü Tƒ±bbi √ñyk√º *</label>
                        <div class="medical-history-container">
                            <div class="medical-history-options">
                                <div class="radio-group">
                                    <input type="radio" id="medicalHistoryYes" name="medicalHistory" value="yes" onchange="toggleMedicalHistoryDetail(true)">
                                    <label for="medicalHistoryYes">Var</label>
                                </div>
                                <div class="radio-group">
                                    <input type="radio" id="medicalHistoryNo" name="medicalHistory" value="no" onchange="toggleMedicalHistoryDetail(false)" checked>
                                    <label for="medicalHistoryNo">Yok</label>
                                </div>
                            </div>
                            <div class="medical-history-detail" id="medicalHistoryDetail">
                                <textarea class="form-textarea" id="newPatientMedicalHistory" rows="3" placeholder="Ge√ßmi≈ü hastalƒ±klar, operasyonlar, hastane yatƒ±≈ülarƒ±..."></textarea>
                            </div>
                        </div>
                    </div>

                    <!-- Sigara Kullanƒ±mƒ± -->
                    <div class="form-group">
                        <label class="form-label">Sigara Kullanƒ±mƒ± *</label>
                        <div class="medical-history-options">
                            <div class="radio-group">
                                <input type="radio" id="smokingYes" name="smoking" value="yes">
                                <label for="smokingYes">Evet</label>
                            </div>
                            <div class="radio-group">
                                <input type="radio" id="smokingNo" name="smoking" value="no" checked>
                                <label for="smokingNo">Hayƒ±r</label>
                            </div>
                        </div>
                    </div>

                    <!-- ƒ∞la√ß / Alerji Durumu -->
                    <div class="form-group form-group-full">
                        <label class="form-label">ƒ∞la√ß / Alerji Durumu *</label>
                        <div class="medical-history-container">
                            <div class="medical-history-options">
                                <div class="radio-group">
                                    <input type="radio" id="allergyYes" name="allergy" value="yes" onchange="toggleAllergyDetail(true)">
                                    <label for="allergyYes">Var</label>
                                </div>
                                <div class="radio-group">
                                    <input type="radio" id="allergyNo" name="allergy" value="no" onchange="toggleAllergyDetail(false)" checked>
                                    <label for="allergyNo">Yok</label>
                                </div>
                            </div>
                            <div class="medical-history-detail" id="allergyDetail">
                                <textarea class="form-textarea" id="newPatientAllergy" rows="3" placeholder="ƒ∞la√ß veya alerji durumunu yazƒ±nƒ±z..."></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <div class="modal-actions">
                        <button type="submit" class="btn-modal btn-confirm" onclick="saveNewPatient(event)">
                            <i class="fas fa-check"></i>
                            Hastayƒ± Kaydet
                        </button>
                        
                        <button type="button" class="btn-modal btn-cancel" onclick="closeAddPatientModal()">
                            <i class="fas fa-times"></i>
                            ƒ∞ptal
                        </button>

                    </div>
                </form>
            </div>
        </div>

        <!-- AI Chatbot -->
        <div class="ai-chatbot" id="aiChatbot">
            <div class="chatbot-header">
                <div class="chatbot-title">
                    <i class="fas fa-robot"></i>
                    AI Tƒ±p Asistanƒ±
                </div>
                <button class="chatbot-close" onclick="closeAIChatbot()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="chatbot-messages" id="chatbotMessages">
                <div class="message bot">
                    Merhaba! Ben MEDIARY AI Asistanƒ±nƒ±zƒ±m. Size genel tƒ±bbi sorularƒ±nƒ±zda yardƒ±mcƒ± olabilirim. 
                    <br><br>
                    <strong>‚ö†Ô∏è √ñnemli:</strong> Spesifik tƒ±bbi durumlar i√ßin mutlaka doktorunuza danƒ±≈üƒ±n.
                </div>
                
                <div class="quick-questions">
                    <button class="quick-question" onclick="askQuickQuestion('Y√ºksek tansiyon belirtileri nelerdir?')">
                        Y√ºksek tansiyon belirtileri nelerdir?
                    </button>
                    <button class="quick-question" onclick="askQuickQuestion('Diabetin √∂nlenmesi nasƒ±l saƒülanƒ±r?')">
                        Diabetin √∂nlenmesi nasƒ±l saƒülanƒ±r?
                    </button>
                    <button class="quick-question" onclick="askQuickQuestion('B√∂brek ta≈üƒ± nasƒ±l √∂nlenir?')">
                        B√∂brek ta≈üƒ± nasƒ±l √∂nlenir?
                    </button>
                    <button class="quick-question" onclick="askQuickQuestion('Saƒülƒ±klƒ± beslenme √∂nerileri')">
                        Saƒülƒ±klƒ± beslenme √∂nerileri
                    </button>
                </div>
                
                <div class="typing-indicator" id="typingIndicator">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <span style="margin-left: 0.5rem; font-size: 0.8rem; color: #64748b;">AI yazƒ±yor...</span>
                </div>
            </div>
            
            <div class="chatbot-input-area">
                <input type="text" class="chatbot-input" id="chatbotInput" placeholder="Tƒ±bbi sorunuzu yazƒ±n..." maxlength="200">
                <button class="chatbot-send" onclick="sendMessage()">
                    <i class="fas fa-paper-plane"></i>
                </button>
            </div>
        </div>
    </div>
    
    <script>
        // Global variables
        let currentPatientId = 1;

        // Patient data structure
        let patientsData = {
            1: {
                name: "Mehmet Kaya",
                tc: "12345678901",
                age: 42,
                gender: "Erkek",
                bloodType: "A+",
                complaint: "Yakla≈üƒ±k √º√ß g√ºnd√ºr saƒü b√∂brek b√∂lgemde ara ara ≈üiddetlenen keskin bir aƒürƒ± hissediyorum. Aƒürƒ± √∂zellikle hareket ettiƒüimde artƒ±yor ve bazen dayanƒ±lmaz hale geliyor. ƒ∞drar yaparken yanma hissi ya≈üƒ±yorum ve idrar rengimde koyula≈üma fark ettim. Ayrƒ±ca zaman zaman idrarda kan g√∂rd√ºm. Son iki g√ºnd√ºr mide bulantƒ±sƒ± olan ve kendimi yorgun hissediyorum. Daha √∂nce b√∂brek ta≈üƒ± d√º≈ü√ºrm√º≈üt√ºm ve ailemde b√∂brek yetmezliƒüi √∂yk√ºs√º var. G√ºnl√ºk su t√ºketimim olduk√ßa az ve son zamanlarda tuzlu gƒ±dalar t√ºketmeye ba≈üladƒ±m. Aƒürƒ±mƒ± hafifletmek i√ßin sƒ±cak su torbasƒ± kullanƒ±yorum, bu bir nebze rahatlama saƒülƒ±yor. Tansiyon ila√ßlarƒ± kullanƒ±yorum ve ge√ßmi≈üte antibiyotik alerjisi ya≈üamƒ±≈ütƒ±m.",
                notes: [
                    {
                        type: "emphasis",
                        text: "Penisilin ilacƒ±na kar≈üƒ± alerjisi bulunmaktadƒ±r."
                    },
                    {
                        type: "normal",
                        text: "Aktif olarak 'Lisinopril' ilacƒ±nƒ± g√ºnde 1 kez kullanmaktadƒ±r."
                    },
                    {
                        type: "normal",
                        text: "Ge√ßmi≈üte b√∂brek ta≈üƒ± √∂yk√ºs√º mevcut. Aile √∂yk√ºs√ºnde b√∂brek yetmezliƒüi var."
                    }
                ]
            },
            2: {
                name: "Fatma Demir",
                tc: "98765432109",
                age: 28,
                gender: "Kadƒ±n",
                bloodType: "B+",
                complaint: "Son bir haftadƒ±r s√ºrekli ba≈ü aƒürƒ±sƒ± √ßekiyorum. √ñzellikle sabahlarƒ± uyanƒ±rken aƒürƒ± daha ≈üiddetli oluyor. G√∂zlerimin √∂n√ºnde parƒ±ltƒ±lar g√∂r√ºyorum ve bazen bulantƒ± hissediyorum.",
                notes: [
                    {
                        type: "emphasis",
                        text: "Migren aile √∂yk√ºs√º mevcut. Anne tarafƒ±ndan kalƒ±tsal."
                    },
                    {
                        type: "normal",
                        text: "Stress seviyesi y√ºksek, yoƒüun √ßalƒ±≈üma temposu var."
                    }
                ]
            },
            3: {
                name: "Zehra √ñzkan",
                tc: "11122233344",
                age: 35,
                gender: "Kadƒ±n",
                bloodType: "0+",
                complaint: "Yakla≈üƒ±k iki g√ºnd√ºr boƒüazƒ±mda ≈üiddetli aƒürƒ± var. Yutkunmakta g√º√ßl√ºk √ßekiyorum ve ses kƒ±sƒ±klƒ±ƒüƒ± ya≈üƒ±yorum. Hafif ate≈üim de var.",
                notes: []
            },
            4: {
                name: "Ali Veli",
                tc: "55566677788",
                age: 53,
                gender: "Erkek",
                bloodType: "AB+",
                complaint: "Ge√ßen hafta ba≈ülayan √∂ks√ºr√ºk giderek artƒ±yor. √ñzellikle geceleri daha √ßok √∂ks√ºr√ºyorum ve balgam √ßƒ±karƒ±yorum. Nefes almakta da zorluk ya≈üƒ±yorum.",
                notes: [
                    {
                        type: "emphasis",
                        text: "30 yƒ±llƒ±k sigara kullanƒ±m √∂yk√ºs√º mevcut."
                    },
                    {
                        type: "normal",
                        text: "KOAH riski y√ºksek. D√ºzenli kontroller gerekli."
                    }
                ]
            }
        };

        // Login Modal Functions
        function showLoginModal() {
            document.getElementById('loginModal').style.display = 'flex';
        }

        function closeLoginModal() {
            document.getElementById('loginModal').style.display = 'none';
        }

        function fillDemoCredentials(username, password) {
            document.getElementById('username').value = username;
            document.getElementById('password').value = password;
        }

        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const errorMessage = document.getElementById('errorMessage');
            const loginSubmit = document.getElementById('loginSubmit');
            
            // Demo credentials
            const validCredentials = {
                'skoz': 'doktor123',
                'ademir': 'hekim456',
                'myilmaz': 'tip789',
                'admin': 'admin123'
            };
            
            if (validCredentials[username] === password) {
                // Show loading state
                const originalText = loginSubmit.innerHTML;
                loginSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Giri≈ü yapƒ±lƒ±yor...';
                loginSubmit.disabled = true;
                loginSubmit.style.background = 'linear-gradient(135deg, #00695c, #004d40)';
                
                // Add realistic delay (2-3 seconds)
                setTimeout(() => {
                    closeLoginModal();
                    showMediarySystem(username);
                    
                    // Reset button state for next time
                    loginSubmit.innerHTML = originalText;
                    loginSubmit.disabled = false;
                    loginSubmit.style.background = 'linear-gradient(135deg, #3b82f6, #1e40af)';
                    document.getElementById("mediarySystem").scrollIntoView({ behavior: "auto" });
                }, 2500); // 2.5 second delay
                
            } else {
                // Show error with shake animation
                loginSubmit.style.animation = 'shake 0.5s ease-in-out';
                errorMessage.style.display = 'block';
                
                setTimeout(() => {
                    errorMessage.style.display = 'none';
                    loginSubmit.style.animation = '';
                }, 3000);
            }
        }

        function showMediarySystem(username) {
            document.getElementById('main-website').style.display = 'none';
            const mediarySystem = document.getElementById('mediarySystem');
            mediarySystem.style.display = 'block';

            // Sistemi yumu≈üak ge√ßi≈üle g√∂ster
            setTimeout(() => {
                mediarySystem.classList.add('show');
            }, 100);

            // Doktor adƒ± e≈üle
            const doctorNames = {
                'skoz': 'Dr. S√ºleyman K√∂z',
                'ademir': 'Dr. Ay≈üe Demir',
                'myilmaz': 'Dr. Mehmet Yƒ±lmaz',
                'admin': 'Admin User'
            };
            
            const doctorName = doctorNames[username] || 'Dr. Kullanƒ±cƒ±';
            document.getElementById('currentUserName').textContent = doctorName;
            document.getElementById('userBadgeName').textContent = doctorName;
            document.getElementById('loginTime').textContent = new Date().toLocaleTimeString('tr-TR');

            // Dashboard g√∂r√ºn√ºm√ºn√º g√∂ster
            showDashboard();

            // Ho≈ü geldin bildirimi
            setTimeout(() => {
                showNotification(`Ho≈ü geldiniz ${doctorName}! MEDIARY sistemine ba≈üarƒ±yla giri≈ü yaptƒ±nƒ±z.`, 'success');
            }, 1000);
        }

        function resetSystem() {
            // T√ºm metin giri≈ülerini ve textarea'larƒ± temizle
            document.querySelectorAll('input[type="text"], textarea').forEach(el => el.value = '');

            // T√ºm checkbox'larƒ± temizle
            document.querySelectorAll('input[type="checkbox"]').forEach(el => el.checked = false);

            // Manuel test listesi temizle
            const manualList = document.getElementById('manualTestsList');
            if (manualList) manualList.innerHTML = '';

            // Se√ßilen testleri temizle
            const selectedList = document.getElementById('selectedTestsList');
            if (selectedList) {
                selectedList.innerHTML = '<div class="selected-test" style="color: rgba(255,255,255,0.5);">‚Ä¢ Hen√ºz tetkik se√ßilmedi</div>';
            }

            const summaryTitle = document.querySelector('.selected-tests-summary h5');
            if (summaryTitle) {
                summaryTitle.textContent = 'Se√ßilen Tetkikler (0 adet):';
            }

            const aiResults = document.getElementById('aiResults');
            if (aiResults) aiResults.style.display = 'none';

            const evaluationLoading = document.getElementById('evaluationLoading');
            if (evaluationLoading) evaluationLoading.style.display = 'none';

            const evaluateBtn = document.getElementById('evaluateBtn');
            if (evaluateBtn) {
                evaluateBtn.style.display = 'block';
            }

            const prescriptionList = document.getElementById('prescriptionList');
            if (prescriptionList) {
                prescriptionList.innerHTML = `
                    <div class="prescription-item">
                        <div class="drug-info">
                            <input type="text" class="drug-name" placeholder="ƒ∞la√ß adƒ±" />
                            <input type="text" class="drug-dosage" placeholder="Dozaj" />
                            <input type="text" class="drug-frequency" placeholder="Kullanƒ±m sƒ±klƒ±ƒüƒ±" />
                            <input type="text" class="drug-duration" placeholder="S√ºre" />
                            <button class="remove-drug-btn" onclick="removeDrug(this)">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                    </div>
                `;
            }

            // AI, Re√ßete ve Tahlil sekmelerini kilitle
            const tabs = ['aiAnalysisTab', 'prescriptionTab', 'evaluationTab'];
            tabs.forEach(id => {
                const tab = document.getElementById(id);
                if (tab) {
                    tab.classList.add('locked');
                    const lockIcon = tab.querySelector('.fa-lock');
                    if (lockIcon) lockIcon.style.display = 'inline';
                }
            });

            showTab('preview');
        }

        function returnToHomepage() {
            document.getElementById('mediarySystem').style.display = 'none';
            document.getElementById('main-website').style.display = 'block';
        }

        // Patient dropdown toggle
        function togglePatientDropdown() {
            const options = document.getElementById('patientOptions');
            const arrow = document.getElementById('dropdownArrow');
            
            options.classList.toggle('show');
            arrow.style.transform = options.classList.contains('show') ? 'rotate(180deg)' : 'rotate(0deg)';
        }

        // View Management Functions
        function showDashboard() {
            document.getElementById('dashboardView').classList.remove('hidden');
            document.getElementById('dashboardView').style.display = 'block';
            document.getElementById('examinationView').classList.remove('active');
            document.getElementById('examinationView').style.display = 'none';
            document.getElementById('backToDashboard').style.display = 'none';
        }

        // Dashboard action functions
        function startPatientExamination() {
            // Dashboard g√∂r√ºn√ºm√ºn√º gizle
            document.getElementById('dashboardView').style.display = 'none';
            
            // Muayene g√∂r√ºn√ºm√ºn√º g√∂ster
            document.getElementById('examinationView').style.display = 'block';
            document.getElementById('examinationView').classList.add('active');
            
            // Dashboard'a d√∂n√º≈ü butonunu g√∂ster
            document.getElementById('backToDashboard').style.display = 'inline-block';

            // Bug√ºn√ºn tarihini ayarla
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('selectedDate').value = today;

            // ƒ∞lk hasta verisini y√ºkle
            loadPatientData(1);

            // Bildirim g√∂ster
            showNotification('Hasta muayene mod√ºl√º ba≈ülatƒ±ldƒ±. Hasta se√ßin ve muayeneye ba≈ülayƒ±n.', 'success');
        }

                function openAIAssistant() {
            showAIAssistant();
        }


        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.querySelector('.patient-dropdown');
            const options = document.getElementById('patientOptions');
            const arrow = document.getElementById('dropdownArrow');
            
            if (dropdown && !dropdown.contains(event.target)) {
                options.classList.remove('show');
                arrow.style.transform = 'rotate(0deg)';
            }
        });

        // Select patient function
        function selectPatient(element, patientId, patientName) {
            resetSystem();
            currentPatientId = patientId;
            
            document.getElementById('selectedPatient').textContent = patientName;
            
            document.querySelectorAll('.patient-option').forEach(option => {
                option.classList.remove('selected');
            });
            element.classList.add('selected');
            
            document.getElementById('patientOptions').classList.remove('show');
            document.getElementById('dropdownArrow').style.transform = 'rotate(0deg)';
            
            loadPatientData(patientId);
        }

        // Load patient data
        function loadPatientData(patientId) {
            const patient = patientsData[patientId];
            if (!patient) {
                console.warn('Patient not found:', patientId);
                return;
            }
            
            document.getElementById('patientTC').textContent = patient.tc;
            document.getElementById('patientAge').textContent = patient.age;
            document.getElementById('patientGender').textContent = patient.gender;
            document.getElementById('patientBloodType').textContent = patient.bloodType;
            
            document.getElementById('complaintText').value = patient.complaint;
            
            updatePatientNotes(patient.notes);
        }

        // Update patient notes
        function updatePatientNotes(notes) {
            const notesContainer = document.querySelector('.patient-notes');
            const existingNotes = notesContainer.querySelectorAll('.note-item');
            
            existingNotes.forEach(note => note.remove());
            
            if (!notes || notes.length === 0) {
                notesContainer.style.display = 'none';
            } else {
                notesContainer.style.display = 'block';
                
                notes.forEach(note => {
                    const noteElement = document.createElement('div');
                    noteElement.className = note.type === 'emphasis' ? 'note-item note-emphasis' : 'note-item';
                    noteElement.textContent = note.text;
                    notesContainer.appendChild(noteElement);
                });
            }
        }

            // Clear workflow cache and reset all tabs
        function clearWorkflowCache() {
            // Reset all tabs to locked state except first one
            const evaluationTab = document.getElementById('evaluationTab');
            const aiAnalysisTab = document.getElementById('aiAnalysisTab');
            const prescriptionTab = document.getElementById('prescriptionTab');
            
            // Lock tabs
            evaluationTab.classList.add('locked');
            aiAnalysisTab.classList.add('locked');
            prescriptionTab.classList.add('locked');
            
            // Show lock icons
            const evaluationLock = evaluationTab.querySelector('.fa-lock');
            const aiLock = aiAnalysisTab.querySelector('.fa-lock');
            const prescriptionLock = prescriptionTab.querySelector('.fa-lock');
            
            if (evaluationLock) evaluationLock.style.display = 'inline';
            if (aiLock) aiLock.style.display = 'inline';
            if (prescriptionLock) prescriptionLock.style.display = 'inline';
            
            // Reset active tab to first one
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector('.nav-tab').classList.add('active');
            
            // Show only first tab content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById('preview-tab').classList.add('active');
            
            // Reset AI analysis state
            const evaluateBtn = document.getElementById('evaluateBtn');
            const loadingSpinner = document.getElementById('evaluationLoading');
            const aiResults = document.getElementById('aiResults');
            const progressFill = document.getElementById('progressFill');
            
            if (evaluateBtn) {
                evaluateBtn.style.display = 'flex';
                evaluateBtn.disabled = false;
                evaluateBtn.innerHTML = '<i class="fas fa-brain"></i> Testleri AI ile Deƒüerlendir';
            }
            
            if (loadingSpinner) {
                loadingSpinner.classList.remove('show');
            }
            
            if (aiResults) {
                aiResults.style.display = 'none';
                aiResults.classList.remove('show');
            }
            
            if (progressFill) {
                progressFill.style.width = '0%';
            }
            
            // Reset save button
            const saveBtn = document.getElementById('saveComplaintBtn');
            if (saveBtn) {
                saveBtn.innerHTML = '<i class="fas fa-save"></i> Tahlil ƒ∞steƒüinde Bulun';
                saveBtn.classList.remove('saved');
            }
            
            // Reset test selections to default
            resetTestSelections();
            
            // Clear any existing notifications
            const existingNotifications = document.querySelectorAll('.notification');
            existingNotifications.forEach(notification => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            });
        }

        // Reset test selections to default and update display
        function resetTestSelections() {
            // Uncheck all tests first
            document.querySelectorAll('.test-checklist input[type="checkbox"]').forEach(checkbox => {
                checkbox.checked = false;
            });
            
            // Check default tests (urgent ones)
            const defaultTests = ['urinalysis', 'creatinine_gfr', 'kidney_ultrasound'];
            defaultTests.forEach(testId => {
                const checkbox = document.getElementById(testId);
                if (checkbox) {
                    checkbox.checked = true;
                }
            });
            
            // Update selected tests display immediately
            updateSelectedTests();
        }

        // Tab switching function with lock check
        function showTab(tabName) {
            const targetTab = document.getElementById(tabName + '-tab');
            const targetButton = event ? event.target.closest('.nav-tab') : document.querySelector(`[onclick="showTab('${tabName}')"]`);
            
            // Check if tab is locked
            if (targetButton && targetButton.classList.contains('locked')) {
                targetButton.style.animation = 'shake 0.5s ease-in-out';
                setTimeout(() => {
                    targetButton.style.animation = '';
                }, 500);
                
                showNotification('Bu sekmeye eri≈ümek i√ßin √∂nceki adƒ±mlarƒ± tamamlamanƒ±z gerekiyor.', 'warning');
                return;
            }
            
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tab buttons
            document.querySelectorAll('.nav-tab').forEach(button => {
                button.classList.remove('active');
            });
            
            // Show target tab and activate button
            if (targetTab) {
                targetTab.classList.add('active');
            }
            
            if (targetButton) {
                targetButton.classList.add('active');
            }
        }

        // Save complaint and unlock evaluation tab
        function saveComplaintAndUnlock() {
            const text = document.getElementById('complaintText').value.trim();
            
            if (text === '') {
                showNotification('L√ºtfen hasta ≈üikayetini yazƒ±nƒ±z.', 'warning');
                return;
            }
            
            patientsData[currentPatientId].complaint = text;
            
            // Unlock evaluation tab
            const evaluationTab = document.getElementById('evaluationTab');
            evaluationTab.classList.remove('locked');
            const lockIcon = evaluationTab.querySelector('.fa-lock');
            if (lockIcon) {
                lockIcon.style.display = 'none';
            }
            
            // Switch to evaluation tab
            showTab('evaluation');
            
            // Update button text
            const saveBtn = document.getElementById('saveComplaintBtn');
            saveBtn.innerHTML = '<i class="fas fa-check"></i> ≈ûikayet Kaydedildi';
            saveBtn.classList.add('saved');
            
            showNotification('Hasta ≈üikayeti kaydedildi! Tahlil ƒ∞steƒüi sekmesi a√ßƒ±ldƒ±.', 'success');

            fetchAndAddTests(text);
        }

        function requestTestsAndUnlock() {
            const selectedTests = new Set();

            // Checkbox ile se√ßilen testleri al
            document.querySelectorAll('.test-checklist input[type="checkbox"]:checked').forEach(cb => {
                const label = cb.nextElementSibling?.textContent.trim();
                if (label) selectedTests.add(label);
            });

            // Manuel olarak eklenen testleri al (#manualTestsList)
            document.querySelectorAll('#selectedTestsList .selected-test').forEach(el => {
                const testName = el.textContent.replace('‚Ä¢', '').trim();
                if (testName) selectedTests.add(testName);
            });

            // Eƒüer hi√ß test yoksa uyarƒ±
            if (selectedTests.size === 0) {
                showNotification('L√ºtfen en az bir tetkik se√ßiniz.', 'warning');
                return;
            }

            // Bildirim doƒüru sayƒ± ile
            showNotification(`Se√ßilen ${selectedTests.size} tetkik isteƒüi laboratuvara g√∂nderildi!`, 'success');

            // AI sekmesini a√ß
            const aiAnalysisTab = document.getElementById('aiAnalysisTab');
            if (aiAnalysisTab) {
                aiAnalysisTab.classList.remove('locked');
                const lockIcon = aiAnalysisTab.querySelector('.fa-lock');
                if (lockIcon) lockIcon.style.display = 'none';
            }

            // Sekmeyi deƒüi≈ütir
            showTab('ai-analysis');
        }




        // View PDF function
        function viewPDF(pdfType) {
            const pdfNames = {
                'kan-tahlili': 'Kan Tahlili Sonu√ßlarƒ±',
                'idrar-tahlili': 'ƒ∞drar Tahlili Sonu√ßlarƒ±',
                'ultrason': 'Ultrason Raporu'
            };
            
            showNotification(`${pdfNames[pdfType]} g√∂r√ºnt√ºleniyor...`, 'info');
        }

        // Enhanced Evaluate tests function with progress bar and notification
        function evaluateTests() {
            const text = document.getElementById('complaintText').value.trim();

            if (text === '') {
                showNotification('L√ºtfen hasta ≈üikayetini yazƒ±nƒ±z.', 'warning');
                return;
            }

            const evaluateBtn = document.getElementById('evaluateBtn');
            const loadingSpinner = document.getElementById('evaluationLoading');
            const aiResults = document.getElementById('aiResults');
            const progressFill = document.getElementById('progressFill');

            // Ba≈ülangƒ±√ß: Button disable ve spinner ba≈ülat
            evaluateBtn.disabled = true;
            evaluateBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Analiz Ediliyor...';
            loadingSpinner.classList.add('show');

            // Progress bar animasyonu
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 2;
                progressFill.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 60);

            // AI analizi ba≈ülat
            fetchAndShowResults(text).then(success => {
                // Spinner'ƒ± durdur, butonu geri a√ß
                loadingSpinner.classList.remove('show');
                evaluateBtn.disabled = false;
                evaluateBtn.innerHTML = '<i class="fas fa-brain"></i> Testleri AI ile Deƒüerlendir';
                progressFill.style.width = '0%';

                if (success) {
                    aiResults.classList.add('show');
                    aiResults.scrollIntoView({ behavior: 'smooth', block: 'start' });
                    showNotification('AI analizi ba≈üarƒ±yla tamamlandƒ±!', 'success');
                } else {
                    showNotification('AI cevabƒ± alƒ±namadƒ±.', 'error');
                }
            });
        }

        // Unlock prescription tab
        function unlockPrescriptionTab() {
            const prescriptionTab = document.getElementById('prescriptionTab');
            prescriptionTab.classList.remove('locked');
            const lockIcon = prescriptionTab.querySelector('.fa-lock');
            if (lockIcon) {
                lockIcon.style.display = 'none';
            }
            
            // Switch to prescription tab
            showTab('prescription');
            
            showNotification('AI analizi tamamlandƒ±! ≈ûimdi re√ßete hazƒ±rlayabilirsiniz.', 'success');
        }

        function updateSelectedTests() {
            const selectedTestsList = document.getElementById('selectedTestsList');
            selectedTestsList.innerHTML = '';

            const selectedTests = new Set(); // hem checkbox hem manuel eklenenleri tek set i√ßinde tutar

            // Checkbox ile se√ßilen testler
            const checkboxes = document.querySelectorAll('.test-checklist input[type="checkbox"]:checked');
            checkboxes.forEach(checkbox => {
                const label = checkbox.nextElementSibling.textContent.trim();
                selectedTests.add(label);
            });

            // Manuel eklenen testler
            const manualTests = document.querySelectorAll('#manualTestsList .selected-test');
            manualTests.forEach(testItem => {
                const label = testItem.textContent.replace('‚Ä¢', '').trim();
                selectedTests.add(label);
            });

            // Se√ßili testleri listele
            if (selectedTests.size === 0) {
                selectedTestsList.innerHTML = '<div class="selected-test" style="color: rgba(255,255,255,0.5);">‚Ä¢ Hen√ºz tetkik se√ßilmedi</div>';
            } else {
                selectedTests.forEach(label => {
                    const testDiv = document.createElement('div');
                    testDiv.className = 'selected-test';
                    testDiv.innerHTML = `‚Ä¢ ${label}`;
                    selectedTestsList.appendChild(testDiv);
                });
            }

            // Sayƒ±yƒ± g√ºncelle
            const summaryTitle = document.querySelector('.selected-tests-summary h5');
            if (summaryTitle) {
                summaryTitle.textContent = `Se√ßilen Tetkikler (${selectedTests.size} adet):`;
            }
        }

        function addManualTest() {
            const input = document.getElementById('manualTestInput');
            const testName = input.value.trim();

            if (testName === "") return;

            // Se√ßilen testler listesine ekle
            const selectedList = document.getElementById('selectedTestsList');

            // Aynƒ± test daha √∂nce eklendiyse tekrar eklenmesin
            const alreadyExists = Array.from(selectedList.children).some(el =>
                el.textContent.includes(testName)
            );
            if (alreadyExists) {
                alert("Bu tetkik zaten eklendi.");
                input.value = '';
                return;
            }

            const selectedItem = document.createElement('div');
            selectedItem.className = 'selected-test';
            selectedItem.textContent = `‚Ä¢ ${testName}`;
            selectedList.appendChild(selectedItem);

            // Toplam sayƒ±yƒ± g√ºncelle
            updateSelectedTestCount();

            // Input temizle
            input.value = '';
        }

        const suggestions = [
            "ALT (SGPT)", "AST (SGOT)", "HbA1c", "A√ßlƒ±k Kan ≈ûekeri",
            "Vitamin B12", "TSH", "fT3", "fT4","Demir", "Ferritin", 
            "Akciƒüer Grafisi", "Batƒ±n Ultrasonu"
        ];

        function filterSuggestions() {
            const input = document.getElementById('manualTestInput');
            const query = input.value.toLowerCase();
            const box = document.getElementById('customSuggestions');

            box.innerHTML = '';
            if (query === '') {
                box.style.display = 'none';
                return;
            }

            const filtered = suggestions.filter(item => item.toLowerCase().includes(query));
            filtered.forEach(s => {
                const div = document.createElement('div');
                div.textContent = s;
                div.onclick = () => {
                    input.value = s;
                    box.style.display = 'none';
                };
                box.appendChild(div);
            });

            box.style.display = filtered.length > 0 ? 'block' : 'none';
        }


        function updateSelectedTestCount() {
            const count = document.querySelectorAll('#selectedTestsList .selected-test').length;
            const summaryHeader = document.querySelector('.selected-tests-summary h5');
            summaryHeader.textContent = `Se√ßilen Tetkikler (${count} adet):`;
        }

        // Add drug to prescription
        function addDrug() {
            const prescriptionList = document.getElementById('prescriptionList');
            const drugItem = document.createElement('div');
            drugItem.className = 'prescription-item';
            drugItem.innerHTML = `
                <div class="drug-info">
                    <input type="text" class="drug-name" placeholder="ƒ∞la√ß adƒ±" />
                    <input type="text" class="drug-dosage" placeholder="Dozaj" />
                    <input type="text" class="drug-frequency" placeholder="Kullanƒ±m sƒ±klƒ±ƒüƒ±" />
                    <input type="text" class="drug-duration" placeholder="S√ºre" />
                    <button class="remove-drug-btn" onclick="removeDrug(this)">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            prescriptionList.appendChild(drugItem);
        }

        // Remove drug from prescription
        function removeDrug(button) {
            const drugItem = button.closest('.prescription-item');
            drugItem.remove();
        }

        // Save prescription
        function savePrescription() {
            showNotification('Re√ßete ba≈üarƒ±yla kaydedildi!', 'success');
        }

        // Print prescription
        function printPrescription() {
            showNotification('Re√ßete yazdƒ±rma i≈ülemi ba≈ülatƒ±lƒ±yor...', 'info');
        }

        // Enhanced notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#4caf50' : type === 'warning' ? '#ff9800' : '#2196f3'};
                color: white;
                padding: 1rem 1.5rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0,0,0,0.3);
                z-index: 2000;
                animation: slideInRight 0.3s ease;
                max-width: 350px;
                font-size: 0.9rem;
                line-height: 1.4;
            `;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.animation = 'slideOutRight 0.3s ease';
                setTimeout(() => {
                    if (document.body.contains(notification)) {
                        document.body.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

            // AI Assistant functions
        function showAIAssistant() {
            document.getElementById('aiChatbot').classList.add('show');
        }

        function closeAIChatbot() {
            document.getElementById('aiChatbot').classList.remove('show');
        }

        function askQuickQuestion(question) {
            const messagesContainer = document.getElementById('chatbotMessages');
            
            // Add user message
            const userMessage = document.createElement('div');
            userMessage.className = 'message user';
            userMessage.textContent = question;
            messagesContainer.appendChild(userMessage);
            
            // Show typing indicator
            const typingIndicator = document.getElementById('typingIndicator');
            typingIndicator.classList.add('show');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
            
            // Simulate AI response after delay
            setTimeout(() => {
                typingIndicator.classList.remove('show');
                
                const botMessage = document.createElement('div');
                botMessage.className = 'message bot';
                botMessage.innerHTML = getAIResponse(question);
                messagesContainer.appendChild(botMessage);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;
            }, 2000);
        }

        function sendMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (message === '') return;
            
            askQuickQuestion(message);
            input.value = '';
        }

        function getAIResponse(question) {
            const responses = {
                'Y√ºksek tansiyon belirtileri nelerdir?': 'Y√ºksek tansiyon belirtileri: ba≈ü aƒürƒ±sƒ±, burun kanamasƒ±, nefes darlƒ±ƒüƒ±, g√∂ƒü√ºs aƒürƒ±sƒ±, ba≈ü d√∂nmesi olabilir. Ancak √ßoƒüu zaman sessiz seyreder.<br><br><strong>‚ö†Ô∏è √ñnemli:</strong> Tansiyon takibi i√ßin d√ºzenli doktor kontrol√º ≈üarttƒ±r.',
                
                'Diabetin √∂nlenmesi nasƒ±l saƒülanƒ±r?': 'Diabetin √∂nlenmesi i√ßin: d√ºzenli egzersiz, saƒülƒ±klƒ± beslenme, kilo kontrol√º, ≈üekerli i√ßeceklerden ka√ßƒ±nma, lif a√ßƒ±sƒ±ndan zengin gƒ±dalar t√ºketme √∂nemlidir.<br><br><strong>‚ö†Ô∏è √ñnemli:</strong> Risk fakt√∂rleri i√ßin doktorunuzla g√∂r√º≈ü√ºn.',
                
                'B√∂brek ta≈üƒ± nasƒ±l √∂nlenir?': 'B√∂brek ta≈üƒ± √∂nlenmesi: g√ºnde 2-3 litre su i√ßme, tuz kƒ±sƒ±tlamasƒ±, kalsiyum a√ßƒ±sƒ±ndan dengeli beslenme, oksalat i√ßeren gƒ±dalarƒ± sƒ±nƒ±rlama.<br><br><strong>‚ö†Ô∏è √ñnemli:</strong> Ge√ßmi≈üte ta≈ü √∂yk√ºs√º varsa √ºroloji takibi gereklidir.',
                
                'Saƒülƒ±klƒ± beslenme √∂nerileri': 'Saƒülƒ±klƒ± beslenme: √ßok √ße≈üitli sebze-meyve, tam tahƒ±llar, yaƒüsƒ±z protein, sƒ±nƒ±rlƒ± i≈ülenmi≈ü gƒ±da, bol su t√ºketimi.<br><br><strong>‚ö†Ô∏è √ñnemli:</strong> √ñzel diyetler i√ßin beslenme uzmanƒ±na danƒ±≈üƒ±n.'
            };
            
            // Check if it's a specific question
            if (responses[question]) {
                return responses[question];
            }
            
            // Check for keywords for general responses
            if (question.toLowerCase().includes('aƒürƒ±') || question.toLowerCase().includes('acƒ±')) {
                return 'Aƒürƒ± konusunda genel √∂neriler verebilirim ancak s√ºrekli veya ≈üiddetli aƒürƒ±lar i√ßin mutlaka doktorunuza ba≈üvurun.<br><br><strong>üè• Acil durumlar i√ßin en yakƒ±n saƒülƒ±k kurulu≈üuna gidin.</strong>';
            }
            
            if (question.toLowerCase().includes('ila√ß') || question.toLowerCase().includes('doz')) {
                return 'ƒ∞la√ß kullanƒ±mƒ± konusunda sadece doktorunuz size doƒüru bilgi verebilir. ƒ∞la√ß dozlarƒ± ve etkile≈üimleri ki≈üiye √∂zeldir.<br><br><strong>‚ö†Ô∏è √ñnemli:</strong> ƒ∞la√ß deƒüi≈üikliƒüi i√ßin mutlaka doktorunuzla g√∂r√º≈ü√ºn.';
            }
            
            if (question.toLowerCase().includes('kanser') || question.toLowerCase().includes('t√ºm√∂r')) {
                return 'Kanser ve t√ºm√∂r konularƒ±nda sadece onkoloji uzmanlarƒ± doƒüru bilgi verebilir.<br><br><strong>üè• Bu konular i√ßin en yakƒ±n saƒülƒ±k kurulu≈üuna gidip uzman doktor g√∂r√º≈ü√º alƒ±n.</strong>';
            }
            
            // Default response for complex medical questions
            return 'Bu √ßok spesifik bir tƒ±p sorusu. Bu t√ºr sorular i√ßin:<br><br><strong>ü©∫ Doktorunuzla g√∂r√º≈ü√ºn</strong><br><strong>üè• En yakƒ±n saƒülƒ±k kurulu≈üuna gidin</strong><br><br>Ben sadece genel saƒülƒ±k bilgileri verebilirim. Te≈ühis ve tedavi i√ßin mutlaka uzman g√∂r√º≈ü√º alƒ±n.';
        }

        function viewPatientRecords() {
            showNotification('Hasta kayƒ±tlarƒ± mod√ºl√º geli≈ütiriliyor...', 'info');
        }

        function openAIAssistant() {
            showNotification();
        }

        function viewReports() {
            showNotification('Raporlar mod√ºl√º geli≈ütiriliyor...', 'info');
        }

        // Dashboard ana sayfaya d√∂n√º≈ü
        function returnToDashboard() {
            // Muayene panelini gizle, dashboard'ƒ± g√∂ster
            document.getElementById('patientSidebar').style.display = 'none';
            document.getElementById('examinationContent').style.display = 'none';
            document.getElementById('dashboardSidebar').style.display = 'block';
            document.getElementById('dashboardContent').style.display = 'block';
            
            showNotification('Dashboard\'a d√∂n√ºld√º.', 'info');
        }

        // New Patient Modal functions
        function showAddPatientModal() {
            document.getElementById('newPatientModal').style.display = 'flex';
        }

        function closeAddPatientModal() {
            document.getElementById('newPatientModal').style.display = 'none';
            document.getElementById('newPatientForm').reset();
            document.getElementById('medicalHistoryDetail').classList.remove('show');
            document.getElementById('allergyDetail').classList.remove('show');
        }

        function saveNewPatient(event) {
            event.preventDefault();
            
            const formData = {
                name: document.getElementById('newPatientName').value,
                tc: document.getElementById('newPatientTC').value,
                age: document.getElementById('newPatientAge').value,
                gender: document.getElementById('newPatientGender').value,
                bloodType: document.getElementById('newPatientBloodType').value,
                medicalHistory: document.querySelector('input[name="medicalHistory"]:checked').value === 'yes' ? 
                    document.getElementById('newPatientMedicalHistory').value : '',
                smoking: document.querySelector('input[name="smoking"]:checked').value,
                allergy: document.querySelector('input[name="allergy"]:checked').value === 'yes' ? 
                    document.getElementById('newPatientAllergy').value : ''
            };
            
            const newPatientId = Math.max(...Object.keys(patientsData).map(Number)) + 1;
            
            patientsData[newPatientId] = {
                name: formData.name,
                tc: formData.tc,
                age: parseInt(formData.age),
                gender: formData.gender,
                bloodType: formData.bloodType,
                complaint: "",
                notes: []
            };
            
            // Add allergy note if exists
            if (formData.allergy) {
                patientsData[newPatientId].notes.push({
                    type: "emphasis",
                    text: "ƒ∞la√ß alerjisi: " + formData.allergy
                });
            }
            
            // Add smoking note if exists
            if (formData.smoking === 'yes') {
                patientsData[newPatientId].notes.push({
                    type: "normal",
                    text: "Sigara kullanƒ±mƒ± mevcut."
                });
            }
            
            // Add to dropdown
            const patientOptions = document.getElementById('patientOptions');
            const newOption = document.createElement('div');
            newOption.className = 'patient-option';
            newOption.textContent = formData.name;
            newOption.onclick = function() { selectPatient(this, newPatientId, formData.name); };
            patientOptions.appendChild(newOption);
            
            // Select the new patient
            selectPatient(newOption, newPatientId, formData.name);
            
            closeAddPatientModal();
            showNotification('Yeni hasta ba≈üarƒ±yla kaydedildi!', 'success');
        }

        // Medical history toggle function
        function toggleMedicalHistoryDetail(show) {
            const detail = document.getElementById('medicalHistoryDetail');
            if (show) {
                detail.classList.add('show');
            } else {
                detail.classList.remove('show');
                document.getElementById('newPatientMedicalHistory').value = '';
            }
        }

        // Allergy toggle function
        function toggleAllergyDetail(show) {
            const detail = document.getElementById('allergyDetail');
            if (show) {
                detail.classList.add('show');
            } else {
                detail.classList.remove('show');
                document.getElementById('newPatientAllergy').value = '';
            }
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'loginModal') {
                closeLoginModal();
            }
        });

        // ESC tu≈üu ile modal kapatma
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLoginModal();
            }
        });

        // Add enter key support for login
        document.addEventListener('DOMContentLoaded', function() {
            // Login form enter key support
            const loginInputs = document.querySelectorAll('#username, #password');
            loginInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('loginSubmit').click();
                    }
                });
            });
        });

        // Suppress console errors for better user experience
        window.addEventListener('error', function(e) {
            e.preventDefault();
            return false;
        });

        window.addEventListener('unhandledrejection', function(e) {
            e.preventDefault();
        });

        // Initialize test change listeners
        function initializeTestListeners() {
            const testCheckboxes = document.querySelectorAll('.test-checklist input[type="checkbox"]');
            testCheckboxes.forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    updateSelectedTests();
                    
                    // Add visual feedback
                    const checkboxItem = this.closest('.checkbox-item');
                    if (this.checked) {
                        checkboxItem.style.background = 'rgba(76, 175, 80, 0.2)';
                        checkboxItem.style.borderLeft = '4px solid #4CAF50';
                    } else {
                        checkboxItem.style.background = 'rgba(255, 255, 255, 0.05)';
                        checkboxItem.style.borderLeft = 'none';
                    }
                });
            });
        }

        // Close modal when clicking outside
        document.addEventListener('click', function(e) {
            if (e.target.id === 'newPatientModal') {
                closeAddPatientModal();
            }
            if (e.target.id === 'loginModal') {
                closeLoginModal();
            }
        });

        // ESC tu≈üu ile modal kapatma
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeLoginModal();
                closeAddPatientModal();
                closeAIChatbot();
            }
        });


        // Add enter key support for chatbot and login
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize test listeners
            setTimeout(() => {
                initializeTestListeners();
                updateSelectedTests();
            }, 1000);
            
            // Add search functionality for tests
            const testSearchInput = document.getElementById('testSearchInput');
            if (testSearchInput) {
                testSearchInput.addEventListener('input', function() {
                    const searchTerm = this.value.toLowerCase();
                    const checkboxItems = document.querySelectorAll('.checkbox-item');
                    
                    checkboxItems.forEach(item => {
                        const label = item.querySelector('label').textContent.toLowerCase();
                        if (label.includes(searchTerm)) {
                            item.style.display = 'flex';
                        } else {
                            item.style.display = 'none';
                        }
                    });
                });
            }
            
            // Chatbot enter key support
            const chatbotInput = document.getElementById('chatbotInput');
            if (chatbotInput) {
                chatbotInput.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        sendMessage();
                    }
                });
            }

            // Login form enter key support
            const loginInputs = document.querySelectorAll('#username, #password');
            loginInputs.forEach(input => {
                input.addEventListener('keypress', function(e) {
                    if (e.key === 'Enter') {
                        document.getElementById('loginSubmit').click();
                    }
                });
            });
        });

        // Suppress console errors for better user experience
        window.addEventListener('error', function(e) {
            e.preventDefault();
            return false;
        });

        window.addEventListener('unhandledrejection', function(e) {
            e.preventDefault();
        });
    </script>
    
    <script>
        async function fetchAndAddTests(complaintText) {
            const spinner = document.getElementById('testLoadingSpinner');
            const progressFill = document.getElementById('testProgressFill');
            const checklistContainer = document.getElementById('testChecklist');

            // Spinner g√∂ster
            spinner.classList.add('show');

            // Progress bar animasyonu ba≈ülat
            let progress = 0;
            const progressInterval = setInterval(() => {
                progress += 2;
                progressFill.style.width = progress + '%';
                if (progress >= 100) {
                    clearInterval(progressInterval);
                }
            }, 50);

            try {
                const response = await fetch('/api/ask_stage1', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({ question: complaintText })
                });
                const data = await response.json();

                // Spinner kapat
                spinner.classList.remove('show');
                progressFill.style.width = '0%';

                if (data.answer) {
                    const lines = data.answer.split('\n').filter(line => line.trim() !== '');
                    checklistContainer.innerHTML = ''; // Listeyi temizle

                    lines.forEach(line => {
                        const testName = line.replace(/^\d+\.\s*/, '').trim();
                        const testId = testName.toLowerCase().replace(/\s+/g, '_').replace(/[^a-z0-9_]/g, '');

                        const checkboxItem = document.createElement('div');
                        checkboxItem.className = 'checkbox-item';
                        checkboxItem.innerHTML = `
                            <input type="checkbox" id="${testId}" checked onchange="updateSelectedTests()">
                            <label for="${testId}">${testName}</label>
                            <span class="priority ai-suggestion">AI √ñnerisi</span>
                        `;
                        checklistContainer.appendChild(checkboxItem);
                    });

                    updateSelectedTests();
                } else {
                    alert("Sunucudan beklenen cevap alƒ±namadƒ±.");
                }
            } catch (error) {
                console.error("Hata:", error);
                alert("Sunucuya baƒülanƒ±rken bir hata olu≈ütu.");
            } finally {
                // Spinner'ƒ± her durumda gizle
                spinner.classList.remove('show');
                progressFill.style.width = '0%';
            }
        }

        async function fetchAndShowResults(complaintText) {
            try {
                const response = await fetch('/api/ask_stage2', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ question: complaintText })
                });

                const data = await response.json();

                if (!data.answer) return false;

                const answerText = data.answer;

                const aiResults = document.getElementById('aiResults');
                const extSection = document.querySelector('.external-model-section');

                if (answerText.includes("Mediary kapsamƒ±nda bu bilgiyi bilmiyorum")) {
                    aiResults.style.display = 'block';
                    document.querySelector('.ai-summary-content').innerHTML = `<p style="color: red; font-weight: bold; padding: 1rem;">
                        Mediary kapsamƒ±nda bu bilgiyi bilmiyorum. En yakƒ±n zamanda bir doktora ba≈üvurun.
                    </p>`;
                    if (extSection) extSection.style.display = 'none';
                    return true;
                }

                const sections = {};
                const sectionRegex = /==\s*(.+?)\s*==\n([\s\S]*?)(?=(==|$))/g;
                let match;
                while ((match = sectionRegex.exec(answerText)) !== null) {
                    sections[match[1].trim()] = match[2].trim();
                }

                if (sections['Kritik Bulgular']) {
                    const kritikDiv = document.querySelector('.summary-card.critical .summary-text');
                    if (kritikDiv) kritikDiv.innerHTML = sections['Kritik Bulgular'].replace(/\n/g, '<br>');
                }

                if (sections['Tedavi √ñnerileri']) {
                    const tedaviDiv = document.querySelector('.summary-card.recommendation .summary-text');
                    if (tedaviDiv) tedaviDiv.innerHTML = sections['Tedavi √ñnerileri'].replace(/\n/g, '<br>');
                }

                if (sections['Dikkat Edilmesi Gerekenler']) {
                    const dikkatDiv = document.querySelector('.summary-card.warning .summary-text');
                    if (dikkatDiv) dikkatDiv.innerHTML = sections['Dikkat Edilmesi Gerekenler'].replace(/\n/g, '<br>');
                }

                if (sections['Harici AI Model Entegrasyonu']) {
                    const extPara = document.querySelector('.external-model-section .model-response p');
                    if (extPara) {
                        extPara.innerHTML = sections['Harici AI Model Entegrasyonu']
                            .replace(/\n/g, '<br>')
                            .replace(/MedicalAI v2\.1 Modeli ile baƒülantƒ± ba≈üarƒ±lƒ±/,
                                `<strong>MedicalAI v2.1 Modeli ile baƒülantƒ± ba≈üarƒ±lƒ±</strong>`);
                    }
                    if (extSection) extSection.style.display = 'block';
                }

                aiResults.style.display = 'block';
                return true;
            } catch (error) {
                console.error("Hata:", error);
                return false;
            }
        }
    </script>
</body>
</html>
        